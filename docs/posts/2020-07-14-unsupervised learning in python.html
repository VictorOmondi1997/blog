<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Victor Omondi">
<meta name="dcterms.date" content="2020-07-14">
<meta name="description" content="Unsupervised learning encompasses a variety of techniques in machine learning, from clustering to dimension reduction to matrix factorization. In this blog, we’ll explore the fundamentals of unsupervised learning and implement the essential algorithms using scikit-learn and scipy.">

<title>blog - Unsupervised Learning in Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/VictorOmondi1997"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/VictorOmondi197"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Unsupervised Learning in Python</h1>
                  <div>
        <div class="description">
          Unsupervised learning encompasses a variety of techniques in machine learning, from clustering to dimension reduction to matrix factorization. In this blog, we’ll explore the fundamentals of unsupervised learning and implement the essential algorithms using scikit-learn and scipy.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">machine-learning</div>
                <div class="quarto-category">unsupervised-learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Victor Omondi </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 14, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#libraries" id="toc-libraries" class="nav-link" data-scroll-target="#libraries">Libraries</a></li>
  <li><a href="#clustering-for-dataset-exploration" id="toc-clustering-for-dataset-exploration" class="nav-link" data-scroll-target="#clustering-for-dataset-exploration">Clustering for dataset exploration</a>
  <ul class="collapse">
  <li><a href="#unsupervised-learning" id="toc-unsupervised-learning" class="nav-link" data-scroll-target="#unsupervised-learning">Unsupervised Learning</a>
  <ul class="collapse">
  <li><a href="#k-means-clustering-with-scikit-learn" id="toc-k-means-clustering-with-scikit-learn" class="nav-link" data-scroll-target="#k-means-clustering-with-scikit-learn">k-means clustering with scikit-learn</a></li>
  <li><a href="#cluster-labels-for-new-samples-1" id="toc-cluster-labels-for-new-samples-1" class="nav-link" data-scroll-target="#cluster-labels-for-new-samples-1">Cluster labels for new samples</a></li>
  <li><a href="#scatter-plots-1" id="toc-scatter-plots-1" class="nav-link" data-scroll-target="#scatter-plots-1">Scatter plots</a></li>
  <li><a href="#clustering-2d-points" id="toc-clustering-2d-points" class="nav-link" data-scroll-target="#clustering-2d-points">Clustering 2D points</a></li>
  <li><a href="#inspect-clustering" id="toc-inspect-clustering" class="nav-link" data-scroll-target="#inspect-clustering">Inspect clustering</a></li>
  </ul></li>
  <li><a href="#evaluating-a-clustering" id="toc-evaluating-a-clustering" class="nav-link" data-scroll-target="#evaluating-a-clustering">Evaluating a clustering</a>
  <ul class="collapse">
  <li><a href="#crosstab-of-labels-and-species" id="toc-crosstab-of-labels-and-species" class="nav-link" data-scroll-target="#crosstab-of-labels-and-species">Crosstab of labels and species</a></li>
  <li><a href="#measuring-clustering-quality" id="toc-measuring-clustering-quality" class="nav-link" data-scroll-target="#measuring-clustering-quality">Measuring clustering quality</a></li>
  <li><a href="#the-number-of-clusters" id="toc-the-number-of-clusters" class="nav-link" data-scroll-target="#the-number-of-clusters">The number of clusters</a></li>
  <li><a href="#how-many-clusters-to-choose" id="toc-how-many-clusters-to-choose" class="nav-link" data-scroll-target="#how-many-clusters-to-choose">How many clusters to choose?</a></li>
  <li><a href="#how-many-clusters-of-grain" id="toc-how-many-clusters-of-grain" class="nav-link" data-scroll-target="#how-many-clusters-of-grain">How many clusters of grain?</a></li>
  <li><a href="#evaluating-the-grain-clustering" id="toc-evaluating-the-grain-clustering" class="nav-link" data-scroll-target="#evaluating-the-grain-clustering">Evaluating the grain clustering</a></li>
  </ul></li>
  <li><a href="#transforming-features-for-better-clusterings" id="toc-transforming-features-for-better-clusterings" class="nav-link" data-scroll-target="#transforming-features-for-better-clusterings">Transforming features for better clusterings</a>
  <ul class="collapse">
  <li><a href="#scaling-fish-data-for-clustering" id="toc-scaling-fish-data-for-clustering" class="nav-link" data-scroll-target="#scaling-fish-data-for-clustering">Scaling fish data for clustering</a></li>
  <li><a href="#clustering-the-fish-data" id="toc-clustering-the-fish-data" class="nav-link" data-scroll-target="#clustering-the-fish-data">Clustering the fish data</a></li>
  <li><a href="#clustering-stocks-using-kmeans" id="toc-clustering-stocks-using-kmeans" class="nav-link" data-scroll-target="#clustering-stocks-using-kmeans">Clustering stocks using KMeans</a></li>
  <li><a href="#which-stocks-move-together" id="toc-which-stocks-move-together" class="nav-link" data-scroll-target="#which-stocks-move-together">Which stocks move together?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#visualization-with-hierarchical-clustering-and-t-sne" id="toc-visualization-with-hierarchical-clustering-and-t-sne" class="nav-link" data-scroll-target="#visualization-with-hierarchical-clustering-and-t-sne">Visualization with hierarchical clustering and t-SNE</a>
  <ul class="collapse">
  <li><a href="#visualizing-hierarchies" id="toc-visualizing-hierarchies" class="nav-link" data-scroll-target="#visualizing-hierarchies">Visualizing hierarchies</a>
  <ul class="collapse">
  <li><a href="#hierarchical-clustering-of-the-grain-data" id="toc-hierarchical-clustering-of-the-grain-data" class="nav-link" data-scroll-target="#hierarchical-clustering-of-the-grain-data">Hierarchical clustering of the grain data</a></li>
  <li><a href="#hierarchies-of-stocks" id="toc-hierarchies-of-stocks" class="nav-link" data-scroll-target="#hierarchies-of-stocks">Hierarchies of stocks</a></li>
  </ul></li>
  <li><a href="#cluster-labels-in-hierarchical-clustering" id="toc-cluster-labels-in-hierarchical-clustering" class="nav-link" data-scroll-target="#cluster-labels-in-hierarchical-clustering">Cluster labels in hierarchical clustering</a>
  <ul class="collapse">
  <li><a href="#different-linkage-different-hierarchical-clustering" id="toc-different-linkage-different-hierarchical-clustering" class="nav-link" data-scroll-target="#different-linkage-different-hierarchical-clustering">Different linkage, different hierarchical clustering!</a></li>
  <li><a href="#extracting-the-cluster-labels" id="toc-extracting-the-cluster-labels" class="nav-link" data-scroll-target="#extracting-the-cluster-labels">Extracting the cluster labels</a></li>
  </ul></li>
  <li><a href="#t-sne-for-2-dimensional-maps" id="toc-t-sne-for-2-dimensional-maps" class="nav-link" data-scroll-target="#t-sne-for-2-dimensional-maps">t-SNE for 2-dimensional maps</a>
  <ul class="collapse">
  <li><a href="#t-sne-visualization-of-grain-dataset" id="toc-t-sne-visualization-of-grain-dataset" class="nav-link" data-scroll-target="#t-sne-visualization-of-grain-dataset">t-SNE visualization of grain dataset</a></li>
  <li><a href="#t-sne-map-of-the-stock-market" id="toc-t-sne-map-of-the-stock-market" class="nav-link" data-scroll-target="#t-sne-map-of-the-stock-market">t-SNE map of the stock market</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#decorrelating-the-data-and-dimension-reduction" id="toc-decorrelating-the-data-and-dimension-reduction" class="nav-link" data-scroll-target="#decorrelating-the-data-and-dimension-reduction">Decorrelating the data and dimension reduction</a>
  <ul class="collapse">
  <li><a href="#visualizing-the-pca-transformation" id="toc-visualizing-the-pca-transformation" class="nav-link" data-scroll-target="#visualizing-the-pca-transformation">Visualizing the PCA transformation</a>
  <ul class="collapse">
  <li><a href="#correlated-data-in-nature" id="toc-correlated-data-in-nature" class="nav-link" data-scroll-target="#correlated-data-in-nature">Correlated data in nature</a></li>
  <li><a href="#decorrelating-the-grain-measurements-with-pca" id="toc-decorrelating-the-grain-measurements-with-pca" class="nav-link" data-scroll-target="#decorrelating-the-grain-measurements-with-pca">Decorrelating the grain measurements with PCA</a></li>
  </ul></li>
  <li><a href="#intrinsic-dimension" id="toc-intrinsic-dimension" class="nav-link" data-scroll-target="#intrinsic-dimension">Intrinsic dimension</a>
  <ul class="collapse">
  <li><a href="#the-first-principal-component" id="toc-the-first-principal-component" class="nav-link" data-scroll-target="#the-first-principal-component">The first principal component</a></li>
  <li><a href="#variance-of-the-pca-features" id="toc-variance-of-the-pca-features" class="nav-link" data-scroll-target="#variance-of-the-pca-features">Variance of the PCA features</a></li>
  </ul></li>
  <li><a href="#dimension-reduction-with-pca" id="toc-dimension-reduction-with-pca" class="nav-link" data-scroll-target="#dimension-reduction-with-pca">Dimension reduction with PCA</a>
  <ul class="collapse">
  <li><a href="#dimension-reduction-of-the-fish-measurements" id="toc-dimension-reduction-of-the-fish-measurements" class="nav-link" data-scroll-target="#dimension-reduction-of-the-fish-measurements">Dimension reduction of the fish measurements</a></li>
  <li><a href="#a-tf-idf-word-frequency-array" id="toc-a-tf-idf-word-frequency-array" class="nav-link" data-scroll-target="#a-tf-idf-word-frequency-array">A tf-idf word-frequency array</a></li>
  <li><a href="#clustering-wikipedia-part-i" id="toc-clustering-wikipedia-part-i" class="nav-link" data-scroll-target="#clustering-wikipedia-part-i">Clustering Wikipedia part I</a></li>
  <li><a href="#clustering-wikipedia-part-ii" id="toc-clustering-wikipedia-part-ii" class="nav-link" data-scroll-target="#clustering-wikipedia-part-ii">Clustering Wikipedia part II</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#discovering-interpretable-features" id="toc-discovering-interpretable-features" class="nav-link" data-scroll-target="#discovering-interpretable-features">Discovering interpretable features</a>
  <ul class="collapse">
  <li><a href="#non-negative-matrix-factorization-nmf" id="toc-non-negative-matrix-factorization-nmf" class="nav-link" data-scroll-target="#non-negative-matrix-factorization-nmf">Non-negative matrix factorization (NMF)</a>
  <ul class="collapse">
  <li><a href="#non-negative-data" id="toc-non-negative-data" class="nav-link" data-scroll-target="#non-negative-data">Non-negative data</a></li>
  <li><a href="#nmf-applied-to-wikipedia-articles" id="toc-nmf-applied-to-wikipedia-articles" class="nav-link" data-scroll-target="#nmf-applied-to-wikipedia-articles">NMF applied to Wikipedia articles</a></li>
  <li><a href="#nmf-features-of-the-wikipedia-articles" id="toc-nmf-features-of-the-wikipedia-articles" class="nav-link" data-scroll-target="#nmf-features-of-the-wikipedia-articles">NMF features of the Wikipedia articles</a></li>
  </ul></li>
  <li><a href="#nmf-learns-interpretable-parts" id="toc-nmf-learns-interpretable-parts" class="nav-link" data-scroll-target="#nmf-learns-interpretable-parts">NMF learns interpretable parts</a>
  <ul class="collapse">
  <li><a href="#nmf-learns-topics-of-documents" id="toc-nmf-learns-topics-of-documents" class="nav-link" data-scroll-target="#nmf-learns-topics-of-documents">NMF learns topics of documents</a></li>
  <li><a href="#explore-the-led-digits-dataset" id="toc-explore-the-led-digits-dataset" class="nav-link" data-scroll-target="#explore-the-led-digits-dataset">Explore the LED digits dataset</a></li>
  <li><a href="#nmf-learns-the-parts-of-images" id="toc-nmf-learns-the-parts-of-images" class="nav-link" data-scroll-target="#nmf-learns-the-parts-of-images">NMF learns the parts of images</a></li>
  <li><a href="#pca-doesnt-learn-parts" id="toc-pca-doesnt-learn-parts" class="nav-link" data-scroll-target="#pca-doesnt-learn-parts">PCA doesn’t learn parts</a></li>
  </ul></li>
  <li><a href="#building-recommender-systems-using-nmf" id="toc-building-recommender-systems-using-nmf" class="nav-link" data-scroll-target="#building-recommender-systems-using-nmf">Building recommender systems using NMF</a>
  <ul class="collapse">
  <li><a href="#which-articles-are-similar-to-cristiano-ronaldo" id="toc-which-articles-are-similar-to-cristiano-ronaldo" class="nav-link" data-scroll-target="#which-articles-are-similar-to-cristiano-ronaldo">Which articles are similar to ‘Cristiano Ronaldo’?</a></li>
  <li><a href="#recommend-musical-artists-part-i" id="toc-recommend-musical-artists-part-i" class="nav-link" data-scroll-target="#recommend-musical-artists-part-i">Recommend musical artists part I</a></li>
  <li><a href="#recommend-musical-artists-part-ii" id="toc-recommend-musical-artists-part-ii" class="nav-link" data-scroll-target="#recommend-musical-artists-part-ii">Recommend musical artists part II</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>Say we have a collection of customers with a variety of characteristics such as age, location, and financial history, and we wish to discover patterns and sort them into clusters. Or perhaps we have a set of texts, such as wikipedia pages, and we wish to segment them into categories based on their content. This is the world of unsupervised learning, called as such because we are not guiding, or supervising, the pattern discovery by some prediction task, but instead uncovering hidden structure from unlabeled data. Unsupervised learning encompasses a variety of techniques in machine learning, from clustering to dimension reduction to matrix factorization. We’ll explore the fundamentals of unsupervised learning and implement the essential algorithms using scikit-learn and scipy. We will explore how to cluster, transform, visualize, and extract insights from unlabeled datasets, and end the session by building a recommender system to recommend popular musical artists.</p>
</section>
<section id="libraries" class="level1">
<h1>Libraries</h1>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> (StandardScaler, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                                   Normalizer, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                                   normalize, </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                                   MaxAbsScaler)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.manifold <span class="im">import</span> TSNE</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> (PCA, </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                                   TruncatedSVD, </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                                   NMF)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.cluster.hierarchy <span class="im">import</span> (linkage, </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                                     dendrogram, </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                                     fcluster)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> pearsonr</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.sparse <span class="im">import</span> csr_matrix</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"ggplot"</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, message<span class="op">=</span><span class="st">"numpy.ufunc size changed"</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, message<span class="op">=</span><span class="st">"invalid value encountered in sign"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="clustering-for-dataset-exploration" class="level1">
<h1>Clustering for dataset exploration</h1>
<p>Exploring how to discover the underlying groups (or “clusters”) in a dataset. We’ll be clustering companies using their stock market prices, and distinguishing different species by clustering their measurements.</p>
<section id="unsupervised-learning" class="level2">
<h2 class="anchored" data-anchor-id="unsupervised-learning">Unsupervised Learning</h2>
<blockquote class="blockquote">
<h3 id="unsupervised-learning-1" class="anchored">Unsupervised learning</h3>
<ul>
<li>Unsupervised learning finds patterns in data</li>
<li>E.g. <em>clustering</em> customers by their purchases</li>
<li>Compressing the data using purchase patterns <em>(dimension reduction)</em></li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="supervised-vs-unsupervised-learning" class="anchored">Supervised vs unsupervised learning</h3>
<ul>
<li><em>Supervised</em> learning finds patterns for a prediction task</li>
<li>E.g. classify tumors as benign or cancerous <em>(labels)</em></li>
<li>Unsupervised learning finds patterns in data</li>
<li>… but <em>without</em> a specific prediction task in mind</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="iris-dataset" class="anchored">Iris dataset</h3>
<ul>
<li>Measurements of many iris plants {% fn 1 %}</li>
<li>3 species of iris: setosa, versicolor, virginica</li>
<li>Petal length, petal width, sepal length, sepal width (the features of the dataset)</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="iris-data-is-4-dimensional" class="anchored">Iris data is 4-dimensional</h3>
<ul>
<li>Iris samples are points in 4 dimensional space</li>
<li>Dimension = number of features</li>
<li>Dimension too high to visualize!</li>
<li>… but unsupervised learning gives insight</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="k-means-clustering" class="anchored">k-means clustering</h3>
<ul>
<li>Finds clusters of samples</li>
<li>Number of clusters must be specified</li>
<li>Implemented in sklearn (“scikit-learn”)</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="cluster-labels-for-new-samples" class="anchored">Cluster labels for new samples</h3>
<ul>
<li>New samples can be assigned to existing clusters</li>
<li>k-means remembers the mean of each cluster (the “centroids”)</li>
<li>Finds the nearest centroid to each new sample</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="scatter-plots" class="anchored">Scatter plots</h3>
<ul>
<li>Scatter plot of sepal length vs petal length</li>
<li>Each point represents an iris sample</li>
<li>Color points by cluster labels</li>
<li>PyPlot (matplotlib.pyplot) TODO: add scatter plot</li>
</ul>
</blockquote>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>iris.keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>dict_keys(['data', 'target', 'frame', 'target_names', 'DESCR', 'feature_names', 'filename'])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> iris.data</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>samples[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>array([[5.1, 3.5, 1.4, 0.2],
       [4.9, 3. , 1.4, 0.2],
       [4.7, 3.2, 1.3, 0.2],
       [4.6, 3.1, 1.5, 0.2],
       [5. , 3.6, 1.4, 0.2]])</code></pre>
</div>
</div>
<section id="k-means-clustering-with-scikit-learn" class="level3">
<h3 class="anchored" data-anchor-id="k-means-clustering-with-scikit-learn">k-means clustering with scikit-learn</h3>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>model.fit(samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>KMeans(n_clusters=3)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> model.predict([[<span class="fl">5.8</span>, <span class="fl">4.</span> , <span class="fl">1.2</span>, <span class="fl">0.2</span>]])</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>labels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>array([1])</code></pre>
</div>
</div>
</section>
<section id="cluster-labels-for-new-samples-1" class="level3">
<h3 class="anchored" data-anchor-id="cluster-labels-for-new-samples-1">Cluster labels for new samples</h3>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>new_samples <span class="op">=</span> [[ <span class="fl">5.7</span>,<span class="fl">4.4</span>,<span class="fl">1.5</span>,<span class="fl">0.4</span>] ,[ <span class="fl">6.5</span>,<span class="fl">3.</span> ,<span class="fl">5.5</span>,<span class="fl">1.8</span>] ,[ <span class="fl">5.8</span>,<span class="fl">2.7</span>,<span class="fl">5.1</span>,<span class="fl">1.9</span>]]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>model.predict(new_samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>array([1, 2, 0])</code></pre>
</div>
</div>
</section>
<section id="scatter-plots-1" class="level3">
<h3 class="anchored" data-anchor-id="scatter-plots-1">Scatter plots</h3>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>labels_iris <span class="op">=</span> model.predict(samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>xs_iris <span class="op">=</span> samples[:,<span class="dv">0</span>]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ys_iris <span class="op">=</span> samples[:,<span class="dv">2</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> sns.scatterplot(xs_iris, ys_iris, hue<span class="op">=</span>labels_iris)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> pd.read_csv(<span class="st">"datasets/points.csv"</span>).values</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>points[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>array([[ 0.06544649, -0.76866376],
       [-1.52901547, -0.42953079],
       [ 1.70993371,  0.69885253],
       [ 1.16779145,  1.01262638],
       [-1.80110088, -0.31861296]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>xs_points <span class="op">=</span> points[:,<span class="dv">0</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>ys_points <span class="op">=</span> points[:,<span class="dv">1</span>]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> sns.scatterplot(xs_points, ys_points)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>There are three clusters</p>
</section>
<section id="clustering-2d-points" class="level3">
<h3 class="anchored" data-anchor-id="clustering-2d-points">Clustering 2D points</h3>
<p>From the scatter plot we saw that the points seem to separate into 3 clusters. we’ll now create a KMeans model to find 3 clusters, and fit it to the data points. After the model has been fit, we’ll obtain the cluster labels for some new points using the <code>.predict()</code> method.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>new_points <span class="op">=</span> pd.read_csv(<span class="st">"datasets/new_points.csv"</span>).values</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>new_points[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>array([[ 0.40023333, -1.26544471],
       [ 0.80323037,  1.28260167],
       [-1.39507552,  0.05572929],
       [-0.34119268, -1.07661994],
       [ 1.54781747,  1.40250049]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a KMeans instance with 3 clusters: model</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>model_points <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model to points</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>model_points.fit(points)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine the cluster labels of new_points: labels</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>labels_points <span class="op">=</span> model_points.predict(new_points)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print cluster labels of new_points</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(labels_points)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0 2 1 0 2 0 2 2 2 1 0 2 2 1 1 2 1 1 2 2 1 2 0 2 0 1 2 1 1 0 0 2 2 2 1 0 2
 2 0 2 1 0 0 1 0 2 1 1 2 2 2 2 1 1 0 0 1 1 1 0 0 2 2 2 0 2 1 2 0 1 0 0 0 2
 0 1 1 0 2 1 0 1 0 2 1 2 1 0 2 2 2 0 2 2 0 1 1 1 1 0 2 0 1 1 0 0 2 0 1 1 0
 1 1 1 2 2 2 2 1 1 2 0 2 1 2 0 1 2 1 1 2 1 2 1 0 2 0 0 2 1 0 2 0 0 1 2 2 0
 1 0 1 2 0 1 1 0 1 2 2 1 2 1 1 2 2 0 2 2 1 0 1 0 0 2 0 2 2 0 0 1 0 0 0 1 2
 2 0 1 0 1 1 2 2 2 0 2 2 2 1 1 0 2 0 0 0 1 2 2 2 2 2 2 1 1 2 1 1 1 1 2 1 1
 2 2 0 1 0 0 1 0 1 0 1 2 2 1 2 2 2 1 0 0 1 2 2 1 2 1 1 2 1 1 0 1 0 0 0 2 1
 1 1 0 2 0 1 0 1 1 2 0 0 0 1 2 2 2 0 2 1 1 2 0 0 1 0 0 1 0 2 0 1 1 1 1 2 1
 1 2 2 0]</code></pre>
</div>
</div>
<p>We’ve successfully performed k-Means clustering and predicted the labels of new points. But it is not easy to inspect the clustering by just looking at the printed labels. A visualization would be far more useful. We’ll inspect the clustering with a scatter plot!</p>
</section>
<section id="inspect-clustering" class="level3">
<h3 class="anchored" data-anchor-id="inspect-clustering">Inspect clustering</h3>
<p>Let’s now inspect the clustering we performed!</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the columns of new_points: xs and ys</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>xs_np <span class="op">=</span> new_points[:,<span class="dv">0</span>]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>ys_np <span class="op">=</span> new_points[:,<span class="dv">1</span>]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a scatter plot of xs and ys, using labels to define the colors</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> plt.scatter(xs_np, ys_np, c<span class="op">=</span>labels_points, alpha<span class="op">=</span><span class="fl">.5</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the cluster centers: centroids</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>centroids_p <span class="op">=</span> model_points.cluster_centers_</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the columns of centroids: centroids_x, centroids_y</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>centroids_x_p <span class="op">=</span> centroids_p[:,<span class="dv">0</span>]</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>centroids_y_p <span class="op">=</span> centroids_p[:,<span class="dv">1</span>]</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a scatter plot of centroids_x and centroids_y</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> plt.scatter(centroids_x_p, centroids_y_p, marker<span class="op">=</span><span class="st">"D"</span>, s<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The clustering looks great! But how can we be sure that 3 clusters is the correct choice? In other words, how can we evaluate the quality of a clustering?</p>
</section>
</section>
<section id="evaluating-a-clustering" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-a-clustering">Evaluating a clustering</h2>
<ul>
<li>Can check correspondence with e.g.&nbsp;iris species</li>
<li>… but what if there are no species to check against?</li>
<li>Measure quality of a clustering</li>
<li>Informs choice of how many clusters to look for</li>
</ul>
<blockquote class="blockquote">
<h3 id="iris-clusters-vs-species" class="anchored">Iris: clusters vs species</h3>
<ul>
<li>k-means found 3 clusters amongst the iris samples</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="cross-tabulation-with-pandas" class="anchored">Cross tabulation with pandas</h3>
<ul>
<li>Clusters vs species is a “cross-tabulation”</li>
</ul>
</blockquote>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>iris_ct <span class="op">=</span> pd.DataFrame({<span class="st">'labels'</span>:labels_iris, <span class="st">'species'</span>:iris.target})</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>iris_ct.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>labels</th>
      <th>species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>np.unique(iris.target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>array([0, 1, 2])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>iris_ct.species.unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>array([0, 1, 2])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>iris.target_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>array(['setosa', 'versicolor', 'virginica'], dtype='&lt;U10')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>iris_ct[<span class="st">'species'</span>] <span class="op">=</span> iris_ct.species.<span class="bu">map</span>({<span class="dv">0</span>:<span class="st">'setosa'</span>, <span class="dv">1</span>:<span class="st">'versicolor'</span>, <span class="dv">2</span>:<span class="st">'virginica'</span>})</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>iris_ct.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>labels</th>
      <th>species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>setosa</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="crosstab-of-labels-and-species" class="level3">
<h3 class="anchored" data-anchor-id="crosstab-of-labels-and-species">Crosstab of labels and species</h3>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pd.crosstab(iris_ct.labels, iris_ct.species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>species</th>
      <th>setosa</th>
      <th>versicolor</th>
      <th>virginica</th>
    </tr>
    <tr>
      <th>labels</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>48</td>
      <td>14</td>
    </tr>
    <tr>
      <th>1</th>
      <td>50</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>2</td>
      <td>36</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="measuring-clustering-quality" class="level3">
<h3 class="anchored" data-anchor-id="measuring-clustering-quality">Measuring clustering quality</h3>
<ul>
<li>Using only samples and their cluster labels</li>
<li>A good clustering has tight clusters</li>
<li>… and samples in each cluster bunched together</li>
</ul>
<blockquote class="blockquote">
<h3 id="inertia-measures-clustering-quality" class="anchored">Inertia measures clustering quality</h3>
<ul>
<li>Measures how spread out the clusters are (lower is better)</li>
<li>Distance from each sample to centroid of its cluster</li>
<li>After <code>fit()</code>, available as attribute <code>inertia_</code></li>
<li>k-means attempts to minimize the inertia when choosing clusters</li>
</ul>
</blockquote>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>model.inertia_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>78.851441426146</code></pre>
</div>
</div>
</section>
<section id="the-number-of-clusters" class="level3">
<h3 class="anchored" data-anchor-id="the-number-of-clusters">The number of clusters</h3>
<ul>
<li>Clusterings of the iris dataset with different numbers of clusters</li>
<li>More clusters means lower inertia</li>
<li>What is the best number of clusters?</li>
</ul>
</section>
<section id="how-many-clusters-to-choose" class="level3">
<h3 class="anchored" data-anchor-id="how-many-clusters-to-choose">How many clusters to choose?</h3>
<ul>
<li>A good clustering has tight clusters (so low inertia)</li>
<li>… but not too many clusters!</li>
<li>Choose an “elbow” in the inertia plot</li>
<li>Where inertia begins to decrease more slowly</li>
<li>E.g. for iris dataset, 3 is a good choice</li>
</ul>
</section>
<section id="how-many-clusters-of-grain" class="level3">
<h3 class="anchored" data-anchor-id="how-many-clusters-of-grain">How many clusters of grain?</h3>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>samples_grain <span class="op">=</span> pd.read_csv(<span class="st">"datasets/samples_grain.csv"</span>).values</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>samples_grain[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>array([[15.26  , 14.84  ,  0.871 ,  5.763 ,  3.312 ,  2.221 ,  5.22  ],
       [14.88  , 14.57  ,  0.8811,  5.554 ,  3.333 ,  1.018 ,  4.956 ],
       [14.29  , 14.09  ,  0.905 ,  5.291 ,  3.337 ,  2.699 ,  4.825 ],
       [13.84  , 13.94  ,  0.8955,  5.324 ,  3.379 ,  2.259 ,  4.805 ],
       [16.14  , 14.99  ,  0.9034,  5.658 ,  3.562 ,  1.355 ,  5.175 ]])</code></pre>
</div>
</div>
<p>an array <code>samples</code> contains the measurements (such as area, perimeter, length, and several others) of samples of grain. What’s a good number of clusters in this case?</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ks_grain <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>inertias_grain <span class="op">=</span> []</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> ks_grain:</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a KMeans instance with k clusters: model</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    model_grain <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit model to samples</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    model_grain.fit(samples_grain)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append the inertia to the list of inertias</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    inertias_grain.append(model_grain.inertia_)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ks vs inertias</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>plt.plot(ks_grain, inertias_grain, <span class="st">'-o'</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'number of clusters, k'</span>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'inertia'</span>)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>plt.xticks(ks_grain)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The inertia decreases very slowly from 3 clusters to 4, so it looks like 3 clusters would be a good choice for this data.</p>
</section>
<section id="evaluating-the-grain-clustering" class="level3">
<h3 class="anchored" data-anchor-id="evaluating-the-grain-clustering">Evaluating the grain clustering</h3>
<p>In fact, the grain samples come from a mix of 3 different grain varieties: “Kama”, “Rosa” and “Canadian”. We will cluster the grain samples into three clusters, and compare the clusters to the grain varieties using a cross-tabulation.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>varieties <span class="op">=</span> pd.read_csv(<span class="st">"datasets/varieties.csv"</span>)[<span class="st">"0"</span>].to_list()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>varieties[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>['Kama wheat', 'Kama wheat', 'Kama wheat', 'Kama wheat', 'Kama wheat']</code></pre>
</div>
</div>
<p>list <code>varieties</code> gives the grain variety for each sample.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a KMeans model with 3 clusters: model</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>model_grain <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use fit_predict to fit model and obtain cluster labels: labels</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>labels_grain <span class="op">=</span> model_grain.fit_predict(samples_grain)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with labels and varieties as columns: df</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>grain_df <span class="op">=</span> pd.DataFrame({<span class="st">'labels'</span>: labels_grain, <span class="st">'varieties'</span>: varieties})</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create crosstab: ct</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>ct_grain <span class="op">=</span> pd.crosstab(grain_df.labels, grain_df.varieties)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display ct</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>ct_grain</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>varieties</th>
      <th>Canadian wheat</th>
      <th>Kama wheat</th>
      <th>Rosa wheat</th>
    </tr>
    <tr>
      <th>labels</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>60</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>60</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>68</td>
      <td>9</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>The cross-tabulation shows that the 3 varieties of grain separate really well into 3 clusters. But depending on the type of data you are working with, the clustering may not always be this good. Is there anything we can do in such situations to improve the clustering?</p>
</section>
</section>
<section id="transforming-features-for-better-clusterings" class="level2">
<h2 class="anchored" data-anchor-id="transforming-features-for-better-clusterings">Transforming features for better clusterings</h2>
<blockquote class="blockquote">
<h3 id="piedmont-wines-dataset-fn-2" class="anchored">Piedmont wines dataset {% fn 2 %}</h3>
<ul>
<li>178 samples from 3 distinct varieties of red wine: Barolo, Grignolino and Barbera</li>
<li>Features measure chemical composition e.g.&nbsp;alcohol content</li>
<li>… also visual properties like “color intensity”</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="feature-variancesfeature" class="anchored">Feature variancesfeature</h3>
<ul>
<li>The wine features have very different variances!</li>
<li>Variance of a feature measures spread of its values</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="standardscaler" class="anchored">StandardScaler</h3>
<ul>
<li>In kmeans: feature variance = feature influence</li>
<li>StandardScaler transforms each feature to have mean 0 and variance 1</li>
<li>Features are said to be “standardized”</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="similar-methods" class="anchored">Similar methods</h3>
<ul>
<li><code>StandardScaler</code> and <code>KMeans</code> have similar methods</li>
<li>Use <code>fit()</code> / <code>transform()</code> with <code>StandardScaler</code></li>
<li>Use <code>fit()</code> / <code>predict()</code> with <code>KMeans</code></li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="standardscaler-then-kmeans" class="anchored"><code>StandardScaler</code>, then <code>KMeans</code></h3>
<ul>
<li>Need to perform two steps: <code>StandardScaler</code>, then <code>KMeans</code></li>
<li>Use sklearn pipeline to combine multiple steps</li>
<li>Data flows from one step into the next</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="sklearn-preprocessing-steps" class="anchored">sklearn preprocessing steps</h3>
<ul>
<li><code>StandardScaler</code> is a “preprocessing” step</li>
<li><code>MaxAbsScaler</code> and <code>Normalizer</code> are other examples</li>
</ul>
</blockquote>
<section id="scaling-fish-data-for-clustering" class="level3">
<h3 class="anchored" data-anchor-id="scaling-fish-data-for-clustering">Scaling fish data for clustering</h3>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>samples_fish <span class="op">=</span> pd.read_csv(<span class="st">"datasets/samples_fish.csv"</span>).values</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>samples_fish[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>array([[242. ,  23.2,  25.4,  30. ,  38.4,  13.4],
       [290. ,  24. ,  26.3,  31.2,  40. ,  13.8],
       [340. ,  23.9,  26.5,  31.1,  39.8,  15.1],
       [363. ,  26.3,  29. ,  33.5,  38. ,  13.3],
       [430. ,  26.5,  29. ,  34. ,  36.6,  15.1]])</code></pre>
</div>
</div>
<p>an array <code>samples_fish</code> {% fn 3 %} gives measurements of fish. Each row represents an individual fish. The measurements, such as weight in grams, length in centimeters, and the percentage ratio of height to length, have very different scales. In order to cluster this data effectively, we’ll need to standardize these features first. We’ll build a pipeline to standardize and cluster the data.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scaler: scaler_fish</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>scaler_fish <span class="op">=</span> StandardScaler()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create KMeans instance: kmeans_fish</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>kmeans_fish <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create pipeline: pipeline_fish</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>pipeline_fish <span class="op">=</span> make_pipeline(scaler_fish, kmeans_fish)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that We’ve built the pipeline, we’ll use it to cluster the fish by their measurements.</p>
</section>
<section id="clustering-the-fish-data" class="level3">
<h3 class="anchored" data-anchor-id="clustering-the-fish-data">Clustering the fish data</h3>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>species_fish <span class="op">=</span> pd.read_csv(<span class="st">"datasets/species_fish.csv"</span>)[<span class="st">"0"</span>].to_list()</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>species_fish[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>['Bream', 'Bream', 'Bream', 'Bream', 'Bream']</code></pre>
</div>
</div>
<p>We’ll now use the standardization and clustering pipeline to cluster the fish by their measurements, and then create a cross-tabulation to compare the cluster labels with the fish species.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the pipeline to samples</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>pipeline_fish.fit(samples_fish)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the cluster labels: labels_fish</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>labels_fish <span class="op">=</span> pipeline_fish.predict(samples_fish)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with labels and species as columns: df</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>fish_df <span class="op">=</span> pd.DataFrame({<span class="st">'labels'</span>:labels_fish, <span class="st">'species'</span>:species_fish})</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create crosstab: ct</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>ct_fish <span class="op">=</span> pd.crosstab(fish_df.labels, fish_df.species)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display ct</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>ct_fish</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>species</th>
      <th>Bream</th>
      <th>Pike</th>
      <th>Roach</th>
      <th>Smelt</th>
    </tr>
    <tr>
      <th>labels</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>33</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>19</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>17</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>It looks like the fish data separates really well into 4 clusters!</p>
</section>
<section id="clustering-stocks-using-kmeans" class="level3">
<h3 class="anchored" data-anchor-id="clustering-stocks-using-kmeans">Clustering stocks using KMeans</h3>
<p>We’ll cluster companies using their daily stock price movements (i.e.&nbsp;the dollar difference between the closing and opening prices for each trading day).</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>movements <span class="op">=</span> pd.read_csv(<span class="st">"datasets/movements.csv"</span>).values</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>movements[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>array([[  0.58    ,  -0.220005,  -3.409998, ...,  -5.359962,   0.840019,
        -19.589981],
       [ -0.640002,  -0.65    ,  -0.210001, ...,  -0.040001,  -0.400002,
          0.66    ],
       [ -2.350006,   1.260009,  -2.350006, ...,   4.790009,  -1.760009,
          3.740021],
       [  0.109997,   0.      ,   0.260002, ...,   1.849999,   0.040001,
          0.540001],
       [  0.459999,   1.77    ,   1.549999, ...,   1.940002,   1.130005,
          0.309998]])</code></pre>
</div>
</div>
<p>A NumPy array <code>movements</code> of daily price movements from 2010 to 2015 (obtained from Yahoo! Finance), where each row corresponds to a company, and each column corresponds to a trading day.</p>
<p>Some stocks are more expensive than others. To account for this, we will include a <code>Normalizer</code> at the beginning of the pipeline. The <code>Normalizer</code> will separately transform each company’s stock price to a relative scale before the clustering begins.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>Normalizer()</code> is different to <code>StandardScaler()</code>. While <code>StandardScaler()</code> standardizes features (such as the features of the fish data) by removing the mean and scaling to unit variance, <code>Normalizer()</code> <strong>rescales</strong> each sample - here, each company’s stock price - independently of the other.</p>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a normalizer: normalizer_movements</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>normalizer_movements <span class="op">=</span> Normalizer()</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a KMeans model with 10 clusters: kmeans_movements</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>kmeans_movements <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a pipeline chaining normalizer and kmeans: pipeline_movements</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>pipeline_movements <span class="op">=</span> make_pipeline(normalizer_movements, kmeans_movements)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit pipeline to the daily price movements</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>pipeline_movements.fit(movements)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>Pipeline(steps=[('normalizer', Normalizer()),
                ('kmeans', KMeans(n_clusters=10))])</code></pre>
</div>
</div>
<p>Now that the pipeline has been set up, we can find out which stocks move together</p>
</section>
<section id="which-stocks-move-together" class="level3">
<h3 class="anchored" data-anchor-id="which-stocks-move-together">Which stocks move together?</h3>
<p>So which company have stock prices that tend to change in the same way? We’ll now inspect the cluster labels from the clustering to find out.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>companies_movements<span class="op">=</span>pd.read_csv(<span class="st">"datasets/companies_movements.csv"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>companies_movements.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Apple</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AIG</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Amazon</td>
    </tr>
    <tr>
      <th>3</th>
      <td>American express</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Boeing</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>companies_movements<span class="op">=</span>companies_movements[<span class="st">"0"</span>].to_list()</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>companies_movements[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>['Apple', 'AIG', 'Amazon', 'American express', 'Boeing']</code></pre>
</div>
</div>
<p>a list <code>companies_movements</code> of the company names</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the cluster labels: labels_movements</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>labels_movements <span class="op">=</span> pipeline_movements.predict(movements)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame aligning labels and companies: df</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>movements_df <span class="op">=</span> pd.DataFrame({<span class="st">'labels'</span>: labels_movements, <span class="st">'companies'</span>: companies_movements})</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display df sorted by cluster label</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>movements_df.sort_values(<span class="st">"labels"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>labels</th>
      <th>companies</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>18</th>
      <td>0</td>
      <td>Goldman Sachs</td>
    </tr>
    <tr>
      <th>26</th>
      <td>0</td>
      <td>JPMorgan Chase</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0</td>
      <td>General Electrics</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0</td>
      <td>Ford</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>Bank of America</td>
    </tr>
    <tr>
      <th>55</th>
      <td>0</td>
      <td>Wells Fargo</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>American express</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>AIG</td>
    </tr>
    <tr>
      <th>22</th>
      <td>1</td>
      <td>HP</td>
    </tr>
    <tr>
      <th>20</th>
      <td>1</td>
      <td>Home Depot</td>
    </tr>
    <tr>
      <th>58</th>
      <td>1</td>
      <td>Xerox</td>
    </tr>
    <tr>
      <th>30</th>
      <td>1</td>
      <td>MasterCard</td>
    </tr>
    <tr>
      <th>23</th>
      <td>1</td>
      <td>IBM</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1</td>
      <td>Dell</td>
    </tr>
    <tr>
      <th>54</th>
      <td>1</td>
      <td>Walgreen</td>
    </tr>
    <tr>
      <th>32</th>
      <td>1</td>
      <td>3M</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1</td>
      <td>Cisco</td>
    </tr>
    <tr>
      <th>33</th>
      <td>1</td>
      <td>Microsoft</td>
    </tr>
    <tr>
      <th>47</th>
      <td>1</td>
      <td>Symantec</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>Caterpillar</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1</td>
      <td>DuPont de Nemours</td>
    </tr>
    <tr>
      <th>39</th>
      <td>2</td>
      <td>Pfizer</td>
    </tr>
    <tr>
      <th>53</th>
      <td>2</td>
      <td>Valero Energy</td>
    </tr>
    <tr>
      <th>37</th>
      <td>2</td>
      <td>Novartis</td>
    </tr>
    <tr>
      <th>42</th>
      <td>2</td>
      <td>Royal Dutch Shell</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2</td>
      <td>British American Tobacco</td>
    </tr>
    <tr>
      <th>57</th>
      <td>2</td>
      <td>Exxon</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2</td>
      <td>GlaxoSmithKline</td>
    </tr>
    <tr>
      <th>35</th>
      <td>2</td>
      <td>Navistar</td>
    </tr>
    <tr>
      <th>46</th>
      <td>2</td>
      <td>Sanofi-Aventis</td>
    </tr>
    <tr>
      <th>52</th>
      <td>2</td>
      <td>Unilever</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2</td>
      <td>Chevron</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2</td>
      <td>ConocoPhillips</td>
    </tr>
    <tr>
      <th>49</th>
      <td>2</td>
      <td>Total</td>
    </tr>
    <tr>
      <th>43</th>
      <td>2</td>
      <td>SAP</td>
    </tr>
    <tr>
      <th>44</th>
      <td>2</td>
      <td>Schlumberger</td>
    </tr>
    <tr>
      <th>40</th>
      <td>3</td>
      <td>Procter Gamble</td>
    </tr>
    <tr>
      <th>27</th>
      <td>3</td>
      <td>Kimberly-Clark</td>
    </tr>
    <tr>
      <th>56</th>
      <td>3</td>
      <td>Wal-Mart</td>
    </tr>
    <tr>
      <th>9</th>
      <td>3</td>
      <td>Colgate-Palmolive</td>
    </tr>
    <tr>
      <th>25</th>
      <td>3</td>
      <td>Johnson &amp; Johnson</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>Amazon</td>
    </tr>
    <tr>
      <th>59</th>
      <td>4</td>
      <td>Yahoo</td>
    </tr>
    <tr>
      <th>21</th>
      <td>5</td>
      <td>Honda</td>
    </tr>
    <tr>
      <th>45</th>
      <td>5</td>
      <td>Sony</td>
    </tr>
    <tr>
      <th>34</th>
      <td>5</td>
      <td>Mitsubishi</td>
    </tr>
    <tr>
      <th>48</th>
      <td>5</td>
      <td>Toyota</td>
    </tr>
    <tr>
      <th>7</th>
      <td>5</td>
      <td>Canon</td>
    </tr>
    <tr>
      <th>24</th>
      <td>6</td>
      <td>Intel</td>
    </tr>
    <tr>
      <th>50</th>
      <td>6</td>
      <td>Taiwan Semiconductor Manufacturing</td>
    </tr>
    <tr>
      <th>51</th>
      <td>6</td>
      <td>Texas instruments</td>
    </tr>
    <tr>
      <th>28</th>
      <td>7</td>
      <td>Coca Cola</td>
    </tr>
    <tr>
      <th>31</th>
      <td>7</td>
      <td>McDonalds</td>
    </tr>
    <tr>
      <th>41</th>
      <td>7</td>
      <td>Philip Morris</td>
    </tr>
    <tr>
      <th>38</th>
      <td>7</td>
      <td>Pepsi</td>
    </tr>
    <tr>
      <th>29</th>
      <td>8</td>
      <td>Lookheed Martin</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8</td>
      <td>Boeing</td>
    </tr>
    <tr>
      <th>36</th>
      <td>8</td>
      <td>Northrop Grumman</td>
    </tr>
    <tr>
      <th>17</th>
      <td>9</td>
      <td>Google/Alphabet</td>
    </tr>
    <tr>
      <th>0</th>
      <td>9</td>
      <td>Apple</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="visualization-with-hierarchical-clustering-and-t-sne" class="level1">
<h1>Visualization with hierarchical clustering and t-SNE</h1>
<p>We’ll Explore two unsupervised learning techniques for data visualization, hierarchical clustering and t-SNE. Hierarchical clustering merges the data samples into ever-coarser clusters, yielding a tree visualization of the resulting cluster hierarchy. t-SNE maps the data samples into 2d space so that the proximity of the samples to one another can be visualized.</p>
<section id="visualizing-hierarchies" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-hierarchies">Visualizing hierarchies</h2>
<blockquote class="blockquote">
<h3 id="visualisations-communicate-insight" class="anchored">Visualisations communicate insight</h3>
<ul>
<li>“t-SNE” : Creates a 2D map of a dataset (later)</li>
<li>“Hierarchical clustering”</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="a-hierarchy-of-groups" class="anchored">A hierarchy of groups</h3>
<ul>
<li>Groups of living things can form a hierarchy</li>
<li>Clusters are contained in one another</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="eurovision-scoring-dataset-fn-4" class="anchored">Eurovision scoring dataset {% fn 4 %}</h3>
<ul>
<li>Countries gave scores to songs performed at the Eurovision 2016</li>
<li>2D array of scores</li>
<li>Rows are countries, columns are songs</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="hierarchical-clustering" class="anchored">Hierarchical clustering</h3>
<ul>
<li>Every country begins in a separate cluster</li>
<li>At each step, the two closest clusters are merged</li>
<li>Continue until all countries in a single cluster</li>
<li>This is “agglomerative” hierarchical clustering</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="the-dendrogram-of-a-hierarchical-clustering" class="anchored">The dendrogram of a hierarchical clustering</h3>
<ul>
<li>Read from the bottom up</li>
<li>Vertical lines represent clusters</li>
</ul>
</blockquote>
<p>With 5 data samples, there would be 4 merge operations, and with 6 data samples, there would be 5 merges, and so on.</p>
<section id="hierarchical-clustering-of-the-grain-data" class="level3">
<h3 class="anchored" data-anchor-id="hierarchical-clustering-of-the-grain-data">Hierarchical clustering of the grain data</h3>
<p>the SciPy <code>linkage()</code> function performs hierarchical clustering on an array of samples. We will use the <code>linkage()</code> function to obtain a hierarchical clustering of the grain samples, and use <code>dendrogram()</code> to visualize the result.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the linkage: mergings_g</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>mergings_g <span class="op">=</span> linkage(samples_grain, method<span class="op">=</span><span class="st">'complete'</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the dendrogram, using varieties as labels</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">7</span>))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>dendrogram(mergings_g,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>           labels<span class="op">=</span>varieties,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>           leaf_rotation<span class="op">=</span><span class="dv">90</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>           leaf_font_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Dendrograms are a great way to illustrate the arrangement of the clusters produced by hierarchical clustering.</p>
</section>
<section id="hierarchies-of-stocks" class="level3">
<h3 class="anchored" data-anchor-id="hierarchies-of-stocks">Hierarchies of stocks</h3>
<p>We used k-means clustering to cluster companies according to their stock price movements. Now, we’ll perform hierarchical clustering of the companies. SciPy hierarchical clustering doesn’t fit into a sklearn pipeline, so we’ll need to use the <code>normalize()</code> function from <code>sklearn.preprocessing</code> instead of <code>Normalizer</code>.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize the movements: normalized_movements</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>normalized_movements <span class="op">=</span> normalize(movements)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the linkage: mergings</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>mergings_m <span class="op">=</span> linkage(normalized_movements, method<span class="op">=</span><span class="st">"complete"</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the dendrogram</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>))</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>dendrogram(mergings_m, labels<span class="op">=</span>companies_movements, leaf_font_size<span class="op">=</span><span class="dv">12</span>, leaf_rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>You can produce great visualizations such as this with hierarchical clustering, but it can be used for more than just visualizations.</p>
</section>
</section>
<section id="cluster-labels-in-hierarchical-clustering" class="level2">
<h2 class="anchored" data-anchor-id="cluster-labels-in-hierarchical-clustering">Cluster labels in hierarchical clustering</h2>
<blockquote class="blockquote">
<h3 id="cluster-labels-in-hierarchical-clustering-1" class="anchored">Cluster labels in hierarchical clustering</h3>
<ul>
<li>Not only a visualisation tool!</li>
<li>Cluster labels at any intermediate stage can be recovered</li>
<li>For use in e.g.&nbsp;cross-tabulations</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="intermediate-clusterings-height-on-dendrogram" class="anchored">Intermediate clusterings &amp; height on dendrogram</h3>
<ul>
<li>E.g. at height 15: Bulgaria, Cyprus, Greece are one cluster</li>
<li>Russia and Moldova are another</li>
<li>Armenia in a cluster on its own</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="dendrograms-show-cluster-distances" class="anchored">Dendrograms show cluster distances</h3>
<ul>
<li>Height on dendrogram = distance between merging clusters</li>
<li>E.g. clusters with only Cyprus and Greece had distance approx. 6</li>
<li>This new cluster distance approx. 12 from cluster with only Bulgaria</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="intermediate-clusterings-height-on-dendrogram-1" class="anchored">Intermediate clusterings &amp; height on dendrogram</h3>
<ul>
<li>Height on dendrogram specifies max. distance between merging clusters</li>
<li>Don’t merge clusters further apart than this (e.g.&nbsp;15)</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="distance-between-clusters" class="anchored">Distance between clusters</h3>
<ul>
<li>Defined by a “linkage method”</li>
<li>Specified via method parameter, e.g.&nbsp;linkage(samples, method=“complete”)</li>
<li>In “complete” linkage: distance between clusters is max. distance between their samples</li>
<li>Different linkage method, different hierarchical clustering!</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="extracting-cluster-labels" class="anchored">Extracting cluster labels</h3>
<ul>
<li>Use the <code>fcluster</code> method</li>
<li>Returns a NumPy array of cluster labels</li>
</ul>
</blockquote>
<p>the linkage method defines how the distance between clusters is measured. In <em>complete</em> linkage, the distance between clusters is the distance between the furthest points of the clusters. In <em>single</em> linkage, the distance between clusters is the distance between the closest points of the clusters.</p>
<section id="different-linkage-different-hierarchical-clustering" class="level3">
<h3 class="anchored" data-anchor-id="different-linkage-different-hierarchical-clustering">Different linkage, different hierarchical clustering!</h3>
<p>We will perform a hierarchical clustering of the voting countries with ‘single’ linkage. Different linkage, different hierarchical clustering!</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>samples_eurovision <span class="op">=</span> pd.read_csv(<span class="st">"datasets/samples_eurovision.csv"</span>).values</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>samples_eurovision[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>array([[ 2., 12.,  0.,  0.,  0.,  8.,  0.,  0.,  0.,  0.,  0.,  0.,  1.,
         0., 10.,  0.,  4.,  0.,  5.,  7.,  0.,  0.,  3.,  0.,  6.,  0.],
       [12.,  0.,  4.,  0.,  0.,  0.,  0.,  6.,  0.,  7.,  8.,  0.,  3.,
         0.,  0.,  0.,  0.,  5.,  1., 12.,  0.,  0.,  2.,  0., 10.,  0.],
       [ 0., 12.,  3.,  0., 12., 10.,  0.,  0.,  0.,  7.,  0.,  0.,  0.,
         0.,  0.,  0.,  1.,  6.,  0.,  5.,  0.,  2.,  0.,  0.,  8.,  4.],
       [ 0.,  3., 12.,  0.,  0.,  5.,  0.,  0.,  0.,  1.,  0.,  2.,  0.,
         0.,  0.,  0.,  0.,  0., 12.,  8.,  4.,  0.,  7.,  6., 10.,  0.],
       [ 0.,  2.,  0., 12.,  0.,  8.,  0.,  0.,  0.,  4.,  1.,  0.,  7.,
         6.,  0.,  0.,  0.,  5.,  3., 12.,  0.,  0.,  0.,  0., 10.,  0.]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>country_names_eurovision <span class="op">=</span> pd.read_csv(<span class="st">"datasets/country_names_eurovision.csv"</span>)[<span class="st">"0"</span>].to_list()</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>country_names_eurovision[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>['Albania', 'Armenia', 'Australia', 'Austria', 'Azerbaijan']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(country_names_eurovision)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>42</code></pre>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the linkage: mergings</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>mergings_ev <span class="op">=</span> linkage(samples_eurovision, method<span class="op">=</span><span class="st">'single'</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the dendrogram</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">9</span>))</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>dendrogram(mergings_ev, labels<span class="op">=</span>country_names_eurovision, leaf_rotation<span class="op">=</span><span class="dv">90</span>, leaf_font_size<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="extracting-the-cluster-labels" class="level3">
<h3 class="anchored" data-anchor-id="extracting-the-cluster-labels">Extracting the cluster labels</h3>
<p>We saw that the intermediate clustering of the grain samples at height 6 has 3 clusters. We will use the <code>fcluster()</code> function to extract the cluster labels for this intermediate clustering, and compare the labels with the grain varieties using a cross-tabulation.</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use fcluster to extract labels: labels_g</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>labels_g <span class="op">=</span> fcluster(mergings_g,<span class="dv">6</span>, criterion<span class="op">=</span><span class="st">'distance'</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with labels and varieties as columns: df</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>grain_df <span class="op">=</span> pd.DataFrame({<span class="st">'labels'</span>: labels_g, <span class="st">'varieties'</span>: varieties})</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create crosstab: ct</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>grain_ct <span class="op">=</span> pd.crosstab(grain_df.labels, grain_df.varieties)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display ct</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grain_ct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>varieties  Canadian wheat  Kama wheat  Rosa wheat
labels                                           
1                       0           0          47
2                       0          52          23
3                      13           1           0
4                      57          17           0</code></pre>
</div>
</div>
<p>We’ve now mastered the fundamentals of k-Means and agglomerative hierarchical clustering. Next, we’ll explore t-SNE, which is a powerful tool for visualizing high dimensional data.</p>
</section>
</section>
<section id="t-sne-for-2-dimensional-maps" class="level2">
<h2 class="anchored" data-anchor-id="t-sne-for-2-dimensional-maps">t-SNE for 2-dimensional maps</h2>
<blockquote class="blockquote">
<h3 id="t-sne-for-2-dimensional-maps-1" class="anchored">t-SNE for 2-dimensional maps</h3>
<ul>
<li>t-SNE = “t-distributed stochastic neighbor embedding”</li>
<li>Maps samples to 2D space (or 3D)</li>
<li>Map approximately preserves nearness of samples</li>
<li>Great for inspecting datasets</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="t-sne-on-the-iris-dataset" class="anchored">t-SNE on the iris dataset</h3>
<ul>
<li>Iris dataset has 4 measurements, so samples are 4-dimensional</li>
<li>t-SNE maps samples to 2D space</li>
<li>t-SNE didn’t know that there were different species</li>
<li>… yet kept the species mostly separate</li>
</ul>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="datasets/iris_scatter.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<blockquote class="blockquote">
<h3 id="interpreting-t-sne-scatter-plots" class="anchored">Interpreting t-SNE scatter plots</h3>
<ul>
<li>“versicolor” and “virginica” harder to distinguish from one another</li>
<li>Consistent with k-means inertia plot: could argue for 2 clusters, or for 3</li>
</ul>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="datasets/iris_inertia_.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<blockquote class="blockquote">
<h3 id="t-sne-in-sklearnin" class="anchored">t-SNE in sklearnIn</h3>
<ul>
<li>2D NumPy array samples</li>
<li>List species giving species of labels as number (0, 1, or 2)</li>
</ul>
</blockquote>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>samples[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>array([[5.1, 3.5, 1.4, 0.2],
       [4.9, 3. , 1.4, 0.2],
       [4.7, 3.2, 1.3, 0.2],
       [4.6, 3.1, 1.5, 0.2],
       [5. , 3.6, 1.4, 0.2]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>iris.target[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>array([0, 0, 0, 0, 0])</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h3 id="t-sne-in-sklearn" class="anchored">t-SNE in sklearn</h3>
</blockquote>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>model_i <span class="op">=</span> TSNE(learning_rate<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>transformed_i <span class="op">=</span> model_i.fit_transform(samples)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>xs_i <span class="op">=</span> transformed_i[:,<span class="dv">0</span>]</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>ys_i <span class="op">=</span> transformed_i[:,<span class="dv">1</span>]</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(xs_i, ys_i, c<span class="op">=</span>iris.target)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-44-output-1.png" class="img-fluid"></p>
</div>
</div>
<blockquote class="blockquote">
<h3 id="t-sne-has-only-fit_transform" class="anchored">t-SNE has only <code>fit_transform()</code></h3>
<ul>
<li>Has a <code>fit_transform()</code> method</li>
<li>Simultaneously fits the model and transforms the data</li>
<li>Has no separate <code>fit()</code> or <code>transform()</code> methods</li>
<li>Can’t extend the map to include new data samples</li>
<li>Must start over each time!</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="t-sne-learning-rate" class="anchored">t-SNE learning rate</h3>
<ul>
<li>Choose learning rate for the dataset</li>
<li>Wrong choice: points bunch together</li>
<li>Try values between 50 and 200</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="different-every-time" class="anchored">Different every time</h3>
<ul>
<li>t-SNE features are different every time</li>
<li>Piedmont wines, 3 runs, 3 different scatter plots!</li>
<li>… however: The wine varieties (=colors) have same position relative to one another</li>
</ul>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="datasets/tsne_example.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<section id="t-sne-visualization-of-grain-dataset" class="level3">
<h3 class="anchored" data-anchor-id="t-sne-visualization-of-grain-dataset">t-SNE visualization of grain dataset</h3>
<p>We’ll apply t-SNE to the grain samples data and inspect the resulting t-SNE features using a scatter plot.</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>variety_numbers_g <span class="op">=</span> pd.read_csv(<span class="st">"datasets/variety_numbers_grains.csv"</span>)[<span class="st">"0"</span>].to_list()</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>variety_numbers_g[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>[1, 1, 1, 1, 1]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>samples_grain[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>array([[15.26  , 14.84  ,  0.871 ,  5.763 ,  3.312 ,  2.221 ,  5.22  ],
       [14.88  , 14.57  ,  0.8811,  5.554 ,  3.333 ,  1.018 ,  4.956 ],
       [14.29  , 14.09  ,  0.905 ,  5.291 ,  3.337 ,  2.699 ,  4.825 ],
       [13.84  , 13.94  ,  0.8955,  5.324 ,  3.379 ,  2.259 ,  4.805 ],
       [16.14  , 14.99  ,  0.9034,  5.658 ,  3.562 ,  1.355 ,  5.175 ]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a TSNE instance: model</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>model_g <span class="op">=</span> TSNE(learning_rate<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply fit_transform to samples: tsne_features</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>tsne_features_g <span class="op">=</span> model_g.fit_transform(samples_grain)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the 0th feature: xs</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>xs_g <span class="op">=</span> tsne_features_g[:,<span class="dv">0</span>]</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the 1st feature: ys</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>ys_g <span class="op">=</span> tsne_features_g[:,<span class="dv">1</span>]</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot, coloring by variety_numbers_g</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>plt.scatter(xs_g, ys_g, c<span class="op">=</span>variety_numbers_g)</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-47-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>the t-SNE visualization manages to separate the 3 varieties of grain samples. But how will it perform on the stock data?</p>
</section>
<section id="t-sne-map-of-the-stock-market" class="level3">
<h3 class="anchored" data-anchor-id="t-sne-map-of-the-stock-market">t-SNE map of the stock market</h3>
<p>t-SNE provides great visualizations when the individual samples can be labeled. We’ll apply t-SNE to the company stock price data. A scatter plot of the resulting t-SNE features, labeled by the company names, gives a map of the stock market! The stock price movements for each company are available as the array <code>normalized_movements</code>. The list <code>companies</code> gives the name of each company.</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a TSNE instance: model</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>model_m <span class="op">=</span> TSNE(learning_rate<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply fit_transform to normalized_movements: tsne_features</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>tsne_features_m <span class="op">=</span> model_m.fit_transform(normalized_movements)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the 0th feature: xs</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>xs_m <span class="op">=</span> tsne_features_m[:,<span class="dv">0</span>]</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the 1th feature: ys</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>ys_m <span class="op">=</span> tsne_features_m[:,<span class="dv">1</span>]</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">14</span>))</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>plt.scatter(xs_m, ys_m)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotate the points</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y, company <span class="kw">in</span> <span class="bu">zip</span>(xs_m, ys_m, companies_movements):</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    plt.annotate(company, (x, y), fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-48-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>It’s visualizations such as this that make t-SNE such a powerful tool for extracting quick insights from high dimensional data.</p>
</section>
</section>
</section>
<section id="decorrelating-the-data-and-dimension-reduction" class="level1">
<h1>Decorrelating the data and dimension reduction</h1>
<p>Dimension reduction summarizes a dataset using its common occuring patterns. We’ll explore the most fundamental of dimension reduction techniques, “Principal Component Analysis” (“PCA”). PCA is often used before supervised learning to improve model performance and generalization. It can also be useful for unsupervised learning. For example, you’ll employ a variant of PCA will allow you to cluster Wikipedia articles by their content!</p>
<section id="visualizing-the-pca-transformation" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-the-pca-transformation">Visualizing the PCA transformation</h2>
<blockquote class="blockquote">
<h3 id="dimension-reduction" class="anchored">Dimension reduction</h3>
<ul>
<li>More efficient storage and computation</li>
<li>Remove less-informative “noise” features</li>
<li>… which cause problems for prediction tasks, e.g.&nbsp;classification, regression</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="principal-component-analysis" class="anchored">Principal Component Analysis</h3>
<ul>
<li>PCA = “Principal Component Analysis”</li>
<li>Fundamental dimension reduction technique</li>
<li>First step “decorrelation” (considered below)</li>
<li>Second step reduces dimension (considered later)</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="pca-aligns-data-with-axes" class="anchored">PCA aligns data with axes</h3>
<ul>
<li>Rotates data samples to be aligned with axes</li>
<li>Shifts data samples so they have mean 0</li>
<li>No information is lostPCA</li>
</ul>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="datasets/pca.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<blockquote class="blockquote">
<h3 id="pca-follows-the-fittransform-pattern" class="anchored">PCA follows the fit/transform pattern</h3>
<ul>
<li><code>PCA</code> a scikit-learn component like <code>KMeans</code> or <code>StandardScaler</code></li>
<li><code>fit()</code> learns the transformation from given data</li>
<li><code>transform()</code> applies the learned transformation</li>
<li><code>transform()</code> can also be applied to new data</li>
</ul>
</blockquote>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>wine <span class="op">=</span> pd.read_csv(<span class="st">"datasets/wine.csv"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>wine.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>class_label</th>
      <th>class_name</th>
      <th>alcohol</th>
      <th>malic_acid</th>
      <th>ash</th>
      <th>alcalinity_of_ash</th>
      <th>magnesium</th>
      <th>total_phenols</th>
      <th>flavanoids</th>
      <th>nonflavanoid_phenols</th>
      <th>proanthocyanins</th>
      <th>color_intensity</th>
      <th>hue</th>
      <th>od280</th>
      <th>proline</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Barolo</td>
      <td>14.23</td>
      <td>1.71</td>
      <td>2.43</td>
      <td>15.6</td>
      <td>127</td>
      <td>2.80</td>
      <td>3.06</td>
      <td>0.28</td>
      <td>2.29</td>
      <td>5.64</td>
      <td>1.04</td>
      <td>3.92</td>
      <td>1065</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Barolo</td>
      <td>13.20</td>
      <td>1.78</td>
      <td>2.14</td>
      <td>11.2</td>
      <td>100</td>
      <td>2.65</td>
      <td>2.76</td>
      <td>0.26</td>
      <td>1.28</td>
      <td>4.38</td>
      <td>1.05</td>
      <td>3.40</td>
      <td>1050</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>Barolo</td>
      <td>13.16</td>
      <td>2.36</td>
      <td>2.67</td>
      <td>18.6</td>
      <td>101</td>
      <td>2.80</td>
      <td>3.24</td>
      <td>0.30</td>
      <td>2.81</td>
      <td>5.68</td>
      <td>1.03</td>
      <td>3.17</td>
      <td>1185</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>Barolo</td>
      <td>14.37</td>
      <td>1.95</td>
      <td>2.50</td>
      <td>16.8</td>
      <td>113</td>
      <td>3.85</td>
      <td>3.49</td>
      <td>0.24</td>
      <td>2.18</td>
      <td>7.80</td>
      <td>0.86</td>
      <td>3.45</td>
      <td>1480</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>Barolo</td>
      <td>13.24</td>
      <td>2.59</td>
      <td>2.87</td>
      <td>21.0</td>
      <td>118</td>
      <td>2.80</td>
      <td>2.69</td>
      <td>0.39</td>
      <td>1.82</td>
      <td>4.32</td>
      <td>1.04</td>
      <td>2.93</td>
      <td>735</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<blockquote class="blockquote">
<h3 id="using-scikit-learn-pca" class="anchored">Using scikit-learn PCA</h3>
<ul>
<li><code>samples_wine</code> = array of two wine features (total_phenols &amp; od280)</li>
</ul>
</blockquote>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>samples_wine <span class="op">=</span> wine[[<span class="st">'total_phenols'</span>, <span class="st">'od280'</span>]].values</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>samples_wine[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>array([[2.8 , 3.92],
       [2.65, 3.4 ],
       [2.8 , 3.17],
       [3.85, 3.45],
       [2.8 , 2.93]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>model_w <span class="op">=</span> PCA()</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>model_w.fit(samples_wine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>PCA()</code></pre>
</div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>transformed_w <span class="op">=</span> model_w.transform(samples_wine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<h3 id="pca-features" class="anchored">PCA features</h3>
<ul>
<li>Rows of transformed correspond to samples</li>
<li>Columns of transformed are the “PCA features”</li>
<li>Row gives PCA feature values of corresponding sample</li>
</ul>
</blockquote>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>transformed_w[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>array([[nan, nan],
       [nan, nan],
       [nan, nan],
       [nan, nan],
       [nan, nan]])</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h3 id="pca-features-are-not-correlated" class="anchored">PCA features are not correlated</h3>
<ul>
<li>Features of dataset are often correlated, e.g.&nbsp;total_phenols and od280</li>
<li>PCA aligns the data with axes</li>
<li>Resulting PCA features are not linearly correlated (“decorrelation”)PCA</li>
</ul>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="datasets/pca.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">pca</figcaption><p></p>
</figure>
</div>
<blockquote class="blockquote">
<h3 id="pearson-correlation" class="anchored">Pearson correlation</h3>
<ul>
<li>Measures linear correlation of features</li>
<li>Value between -1 and 1</li>
<li>Value of 0 means no linear correlation</li>
</ul>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="datasets/pearson_scatter.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<blockquote class="blockquote">
<h3 id="principal-components" class="anchored">Principal components</h3>
<ul>
<li>“Principal components” = directions of variance</li>
<li>PCA aligns principal components with the axes</li>
<li>Available as <code>components_</code> attribute of PCA object</li>
<li>Each row defines displacement from mean</li>
</ul>
</blockquote>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>model_w.components_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>array([[nan, nan],
       [nan, nan]])</code></pre>
</div>
</div>
<section id="correlated-data-in-nature" class="level3">
<h3 class="anchored" data-anchor-id="correlated-data-in-nature">Correlated data in nature</h3>
<p>We have array <code>grains</code> giving the width and length of samples of grain. We suspect that width and length will be correlated. To confirm this, let’s make a scatter plot of width vs length and measure their Pearson correlation.</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the 0th column of grains: width</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>width_g <span class="op">=</span> samples_grain[:,<span class="dv">4</span>]</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the 1st column of grains: length</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>length_g <span class="op">=</span> samples_grain[:,<span class="dv">3</span>]</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot width vs length</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(width_g, length_g)</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'equal'</span>)</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the Pearson correlation</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>correlation_g, pvalue_g <span class="op">=</span> pearsonr(width_g, length_g)</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the correlation</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>correlation_g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-55-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>0.8604149377143469</code></pre>
</div>
</div>
<p>As you would expect, the width and length of the grain samples are highly correlated.</p>
</section>
<section id="decorrelating-the-grain-measurements-with-pca" class="level3">
<h3 class="anchored" data-anchor-id="decorrelating-the-grain-measurements-with-pca">Decorrelating the grain measurements with PCA</h3>
<p>We observed that the width and length measurements of the grain are correlated. Now, we’ll use PCA to decorrelate these measurements, then plot the decorrelated points and measure their Pearson correlation.</p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>grains <span class="op">=</span> pd.read_csv(<span class="st">"datasets/grains.csv"</span>).values</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>grains[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>array([[3.312, 5.763],
       [3.333, 5.554],
       [3.337, 5.291],
       [3.379, 5.324],
       [3.562, 5.658]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create PCA instance: model_g</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>model_g <span class="op">=</span> PCA()</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the fit_transform method of model to grains: pca_features</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>pca_features_g <span class="op">=</span> model_g.fit_transform(grains)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign 0th column of pca_features: xs</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>xs_g <span class="op">=</span> pca_features_g[:,<span class="dv">0</span>]</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign 1st column of pca_features: ys</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>ys_g <span class="op">=</span> pca_features_g[:,<span class="dv">1</span>]</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot xs vs ys</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>plt.scatter(xs_g, ys_g)</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'equal'</span>)</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the Pearson correlation of xs and ys</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>correlation_g, pvalue_g <span class="op">=</span> pearsonr(xs_g, ys_g)</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the correlation</span></span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>correlation_g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-57-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>1.5634195327240974e-16</code></pre>
</div>
</div>
<p>principal components have to align with the axes of the point cloud.</p>
</section>
</section>
<section id="intrinsic-dimension" class="level2">
<h2 class="anchored" data-anchor-id="intrinsic-dimension">Intrinsic dimension</h2>
<blockquote class="blockquote">
<h3 id="intrinsic-dimension-of-a-flight-path" class="anchored">Intrinsic dimension of a flight path</h3>
<ul>
<li>2 features: longitude and latitude at points along a flight path</li>
<li>Dataset appears to be 2-dimensional</li>
<li>But can approximate using one feature: displacement along flight path</li>
<li>Is intrinsically 1-dimensiona</li>
</ul>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="datasets/flight.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<blockquote class="blockquote">
<h3 id="intrinsic-dimension-1" class="anchored">Intrinsic dimension</h3>
<ul>
<li>Intrinsic dimension = number of features needed to approximate the dataset</li>
<li>Essential idea behind dimension reduction</li>
<li>What is the most compact representation of the samples?</li>
<li>Can be detected with PCA</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="versicolor-dataset" class="anchored">Versicolor dataset</h3>
<ul>
<li>“versicolor”, one of the iris species</li>
<li>Only 3 features: sepal length, sepal width, and petal width</li>
<li>Samples are points in 3D space</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="versicolor-dataset-has-intrinsic-dimension-2" class="anchored">Versicolor dataset has intrinsic dimension 2</h3>
<ul>
<li>Samples lie close to a flat 2-dimensional sheet</li>
<li>So can be approximated using 2 features</li>
</ul>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="datasets/versicolor.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<blockquote class="blockquote">
<h3 id="pca-identifies-intrinsic-dimension" class="anchored">PCA identifies intrinsic dimension</h3>
<ul>
<li>Scatter plots work only if samples have 2 or 3 features</li>
<li>PCA identifies intrinsic dimension when samples have any number of features</li>
<li>Intrinsic dimension = number of PCA features with significant variance</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="pca-of-the-versicolor-samples" class="anchored">PCA of the versicolor samples</h3>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="datasets/pca_versicolor.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<blockquote class="blockquote">
<h3 id="pca-features-are-ordered-by-variance-descending" class="anchored">PCA features are ordered by variance descending</h3>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="datasets/pca_variance.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<blockquote class="blockquote">
<h3 id="variance-and-intrinsic-dimension" class="anchored">Variance and intrinsic dimension</h3>
<ul>
<li>Intrinsic dimension is number of PCA features with significant variance</li>
<li>In our example: the first two PCA features</li>
<li>So intrinsic dimension is 2</li>
</ul>
</blockquote>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>iris.target_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>array(['setosa', 'versicolor', 'virginica'], dtype='&lt;U10')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>versicolor <span class="op">=</span> pd.DataFrame(iris.data, columns<span class="op">=</span>iris.feature_names)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>versicolor[<span class="st">'target'</span>] <span class="op">=</span> iris.target</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>versicolor <span class="op">=</span> versicolor[versicolor.target<span class="op">==</span><span class="dv">1</span>]</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>versicolor.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sepal length (cm)</th>
      <th>sepal width (cm)</th>
      <th>petal length (cm)</th>
      <th>petal width (cm)</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>50</th>
      <td>7.0</td>
      <td>3.2</td>
      <td>4.7</td>
      <td>1.4</td>
      <td>1</td>
    </tr>
    <tr>
      <th>51</th>
      <td>6.4</td>
      <td>3.2</td>
      <td>4.5</td>
      <td>1.5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>52</th>
      <td>6.9</td>
      <td>3.1</td>
      <td>4.9</td>
      <td>1.5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>53</th>
      <td>5.5</td>
      <td>2.3</td>
      <td>4.0</td>
      <td>1.3</td>
      <td>1</td>
    </tr>
    <tr>
      <th>54</th>
      <td>6.5</td>
      <td>2.8</td>
      <td>4.6</td>
      <td>1.5</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>samples_versicolor <span class="op">=</span> versicolor[[<span class="st">'sepal length (cm)'</span>, <span class="st">'sepal width (cm)'</span>, <span class="st">'petal width (cm)'</span>]].values</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>samples_versicolor[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>array([[7. , 3.2, 1.4],
       [6.4, 3.2, 1.5],
       [6.9, 3.1, 1.5],
       [5.5, 2.3, 1.3],
       [6.5, 2.8, 1.5]])</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h3 id="plotting-the-variances-of-pca-features" class="anchored">Plotting the variances of PCA features</h3>
<ul>
<li>samples_versicolor = array of versicolor samples</li>
</ul>
</blockquote>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>pca_versicolor <span class="op">=</span> PCA()</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>pca_versicolor.fit(samples_versicolor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>PCA()</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>features_versicolor <span class="op">=</span> <span class="bu">range</span>(pca_versicolor.n_components_)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>plt.bar(features_versicolor, pca_versicolor.explained_variance_)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>plt.xticks(features_versicolor)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"PCA feature"</span>)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Variance"</span>)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-62-output-1.png" class="img-fluid"></p>
</div>
</div>
<blockquote class="blockquote">
<h3 id="intrinsic-dimension-can-be-ambiguous" class="anchored">Intrinsic dimension can be ambiguous</h3>
<ul>
<li>Intrinsic dimension is an idealization</li>
<li>… there is not always one correct answer!</li>
<li>Piedmont wines: could argue for 2, or for 3, or more</li>
</ul>
</blockquote>
<section id="the-first-principal-component" class="level3">
<h3 class="anchored" data-anchor-id="the-first-principal-component">The first principal component</h3>
<p>The first principal component of the data is the direction in which the data varies the most. We will use PCA to find the first principal component of the length and width measurements of the grain samples, and represent it as an arrow on the scatter plot.</p>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a scatter plot of the untransformed points</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(grains[:,<span class="dv">0</span>], grains[:,<span class="dv">1</span>])</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model to points</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>model_g.fit(grains)</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the mean of the grain samples: mean</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>mean_g <span class="op">=</span> model_g.mean_</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the first principal component: first_pc</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>first_pc_g <span class="op">=</span> model_g.components_[<span class="dv">0</span>,:]</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot first_pc as an arrow, starting at mean</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>plt.arrow(mean_g[<span class="dv">0</span>], mean_g[<span class="dv">1</span>], first_pc_g[<span class="dv">0</span>], first_pc_g[<span class="dv">1</span>], color<span class="op">=</span><span class="st">'blue'</span>, width<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep axes on same scale</span></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'equal'</span>)</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-63-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>This is the direction in which the grain data varies the most.</p>
</section>
<section id="variance-of-the-pca-features" class="level3">
<h3 class="anchored" data-anchor-id="variance-of-the-pca-features">Variance of the PCA features</h3>
<p>The fish dataset is 6-dimensional. But what is its intrinsic dimension? We will make a plot of the variances of the PCA features to find out. We’ll need to standardize the features first.</p>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scaler: scaler</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>scaler_fish <span class="op">=</span> StandardScaler()</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a PCA instance: pca</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>pca_fish <span class="op">=</span> PCA()</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create pipeline: pipeline</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>pipeline_fish <span class="op">=</span> make_pipeline(scaler_fish, pca_fish)</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the pipeline to 'samples'</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>pipeline_fish.fit(samples_fish)</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the explained variances</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>features_fish <span class="op">=</span> <span class="bu">range</span>(pca_fish.n_components_)</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>plt.bar(features_fish, pca_fish.explained_variance_)</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'PCA feature'</span>)</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'variance'</span>)</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>plt.xticks(features_fish)</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-64-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>It looks like PCA features 0 and 1 have significant variance. Since PCA features 0 and 1 have significant variance, the intrinsic dimension of this dataset appears to be 2.</p>
</section>
</section>
<section id="dimension-reduction-with-pca" class="level2">
<h2 class="anchored" data-anchor-id="dimension-reduction-with-pca">Dimension reduction with PCA</h2>
<blockquote class="blockquote">
<h3 id="dimension-reduction-1" class="anchored">Dimension reduction</h3>
<ul>
<li>Represents same data, using less features</li>
<li>Important part of machine-learning pipelines</li>
<li>Can be performed using PCA</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="dimension-reduction-with-pca-1" class="anchored">Dimension reduction with PCA</h3>
<ul>
<li>PCA features are in decreasing order of variance</li>
<li>Assumes the low variance features are “noise”</li>
<li>… and high variance features are informative</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="dimension-reduction-with-pca-2" class="anchored">Dimension reduction with PCA</h3>
<ul>
<li>Specify how many features to keep</li>
<li>E.g. <code>PCA(n_components=2)</code></li>
<li>Keeps the first 2 PCA features</li>
<li>Intrinsic dimension is a good choice</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="dimension-reduction-of-iris-dataset" class="anchored">Dimension reduction of iris dataset</h3>
<ul>
<li><code>samples</code> = array of iris measurements (4 features)</li>
<li><code>species</code> = list of iris species numbers</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="dimension-reduction-with-pca-3" class="anchored">Dimension reduction with PCA</h3>
<ul>
<li>Discards low variance PCA features</li>
<li>Assumes the high variance features are informative</li>
<li>Assumption typically holds in practice (e.g.&nbsp;for iris)</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="word-frequency-arrays" class="anchored">Word frequency arrays</h3>
<ul>
<li>Rows represent documents, columns represent words</li>
<li>Entries measure presence of each word in each document</li>
<li>… measure using “tf-idf” (more later)</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="sparse-arrays-and-csr_matrix" class="anchored">Sparse arrays and csr_matrix</h3>
<ul>
<li>Array is “sparse”: most entries are zero</li>
<li>Can use <code>scipy.sparse.csr_matrix</code> instead of NumPy array</li>
<li><code>csr_matrix</code> remembers only the non-zero entries (saves space!)</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="truncatedsvd-and-csr_matrix" class="anchored">TruncatedSVD and csr_matrix</h3>
<ul>
<li>scikit-learn PCA doesn’t support <code>csr_matrix</code></li>
<li>Use scikit-learn <code>TruncatedSVD</code> instead</li>
<li>Performs same transformation</li>
</ul>
</blockquote>
<section id="dimension-reduction-of-the-fish-measurements" class="level3">
<h3 class="anchored" data-anchor-id="dimension-reduction-of-the-fish-measurements">Dimension reduction of the fish measurements</h3>
<p>We saw that <code>2</code> was a reasonable choice for the “intrinsic dimension” of the fish measurements. We will use PCA for dimensionality reduction of the fish measurements, retaining only the 2 most important components.</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>scaled_samples_fish <span class="op">=</span> pd.read_csv(<span class="st">"datasets/scaled_samples_fish.csv"</span>).values</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>scaled_samples_fish[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>array([[-0.50109735, -0.36878558, -0.34323399, -0.23781518,  1.0032125 ,
         0.25373964],
       [-0.37434344, -0.29750241, -0.26893461, -0.14634781,  1.15869615,
         0.44376493],
       [-0.24230812, -0.30641281, -0.25242364, -0.15397009,  1.13926069,
         1.0613471 ],
       [-0.18157187, -0.09256329, -0.04603648,  0.02896467,  0.96434159,
         0.20623332],
       [-0.00464454, -0.0747425 , -0.04603648,  0.06707608,  0.8282934 ,
         1.0613471 ]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a PCA model with 2 components: pca</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>pca_fish <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the PCA instance to the scaled samples</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>pca_fish.fit(scaled_samples_fish)</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the scaled samples: pca_features</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>pca_features_fish <span class="op">=</span> pca_fish.transform(scaled_samples_fish)</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the shape of pca_features</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>pca_features_fish.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>(85, 2)</code></pre>
</div>
</div>
<p>We’ve successfully reduced the dimensionality from 6 to 2.</p>
</section>
<section id="a-tf-idf-word-frequency-array" class="level3">
<h3 class="anchored" data-anchor-id="a-tf-idf-word-frequency-array">A tf-idf word-frequency array</h3>
<p>We’ll create a tf-idf word frequency array for a toy collection of documents. For this, we will use the <code>TfidfVectorizer</code> from sklearn. It transforms a list of documents into a word frequency array, which it outputs as a <code>csr_matrix</code>. It has <code>fit()</code> and <code>transform()</code> methods like other sklearn objects.</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>documents <span class="op">=</span> [<span class="st">'cats say meow'</span>, <span class="st">'dogs say woof'</span>, <span class="st">'dogs chase cats'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a TfidfVectorizer: tfidf</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>tfidf_d <span class="op">=</span> TfidfVectorizer() </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply fit_transform to document: csr_mat</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>csr_mat_d <span class="op">=</span> tfidf_d.fit_transform(documents)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print result of toarray() method</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(csr_mat_d.toarray())</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the words: words</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>words_d <span class="op">=</span> tfidf_d.get_feature_names()</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print words</span></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>words_d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0.51785612 0.         0.         0.68091856 0.51785612 0.        ]
 [0.         0.         0.51785612 0.         0.51785612 0.68091856]
 [0.51785612 0.68091856 0.51785612 0.         0.         0.        ]]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>['cats', 'chase', 'dogs', 'meow', 'say', 'woof']</code></pre>
</div>
</div>
</section>
<section id="clustering-wikipedia-part-i" class="level3">
<h3 class="anchored" data-anchor-id="clustering-wikipedia-part-i">Clustering Wikipedia part I</h3>
<p><code>TruncatedSVD</code> is able to perform PCA on sparse arrays in <code>csr_matrix</code> format, such as word-frequency arrays. We will cluster some popular pages from Wikipedia {% fn 5 %}. We will build the pipeline and apply it to the word-frequency array of some Wikipedia articles.</p>
<p>The Pipeline object will be consisting of a <code>TruncatedSVD</code> followed by <code>KMeans</code>.</p>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a TruncatedSVD instance: svd</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>svd_wp <span class="op">=</span> TruncatedSVD(n_components<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a KMeans instance: kmeans</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>kmeans_wp <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pipeline: pipeline</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>pipeline_wp <span class="op">=</span> make_pipeline(svd_wp, kmeans_wp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have set up the pipeline, we will use to cluster the articles.</p>
</section>
<section id="clustering-wikipedia-part-ii" class="level3">
<h3 class="anchored" data-anchor-id="clustering-wikipedia-part-ii">Clustering Wikipedia part II</h3>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>wv <span class="op">=</span> pd.read_csv(<span class="st">"datasets/Wikipedia_articles/wikipedia-vectors.csv"</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>articles <span class="op">=</span> csr_matrix(wv.transpose())</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>articles_titles <span class="op">=</span> <span class="bu">list</span>(wv.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the pipeline to articles</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>pipeline_wp.fit(articles)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the cluster labels: labels</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>labels_wp <span class="op">=</span> pipeline_wp.predict(articles)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame aligning labels and titles: df</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>wp <span class="op">=</span> pd.DataFrame({<span class="st">'label'</span>: labels_wp, <span class="st">'article'</span>: articles_titles})</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display df sorted by cluster label</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>wp.sort_values(<span class="st">"label"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>label</th>
      <th>article</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>47</th>
      <td>0</td>
      <td>Fever</td>
    </tr>
    <tr>
      <th>40</th>
      <td>0</td>
      <td>Tonsillitis</td>
    </tr>
    <tr>
      <th>41</th>
      <td>0</td>
      <td>Hepatitis B</td>
    </tr>
    <tr>
      <th>42</th>
      <td>0</td>
      <td>Doxycycline</td>
    </tr>
    <tr>
      <th>43</th>
      <td>0</td>
      <td>Leukemia</td>
    </tr>
    <tr>
      <th>44</th>
      <td>0</td>
      <td>Gout</td>
    </tr>
    <tr>
      <th>45</th>
      <td>0</td>
      <td>Hepatitis C</td>
    </tr>
    <tr>
      <th>46</th>
      <td>0</td>
      <td>Prednisone</td>
    </tr>
    <tr>
      <th>49</th>
      <td>0</td>
      <td>Lymphoma</td>
    </tr>
    <tr>
      <th>48</th>
      <td>0</td>
      <td>Gabapentin</td>
    </tr>
    <tr>
      <th>58</th>
      <td>1</td>
      <td>Sepsis</td>
    </tr>
    <tr>
      <th>59</th>
      <td>1</td>
      <td>Adam Levine</td>
    </tr>
    <tr>
      <th>50</th>
      <td>1</td>
      <td>Chad Kroeger</td>
    </tr>
    <tr>
      <th>51</th>
      <td>1</td>
      <td>Nate Ruess</td>
    </tr>
    <tr>
      <th>52</th>
      <td>1</td>
      <td>The Wanted</td>
    </tr>
    <tr>
      <th>53</th>
      <td>1</td>
      <td>Stevie Nicks</td>
    </tr>
    <tr>
      <th>54</th>
      <td>1</td>
      <td>Arctic Monkeys</td>
    </tr>
    <tr>
      <th>55</th>
      <td>1</td>
      <td>Black Sabbath</td>
    </tr>
    <tr>
      <th>56</th>
      <td>1</td>
      <td>Skrillex</td>
    </tr>
    <tr>
      <th>57</th>
      <td>1</td>
      <td>Red Hot Chili Peppers</td>
    </tr>
    <tr>
      <th>28</th>
      <td>2</td>
      <td>Anne Hathaway</td>
    </tr>
    <tr>
      <th>27</th>
      <td>2</td>
      <td>Dakota Fanning</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2</td>
      <td>Mila Kunis</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2</td>
      <td>Russell Crowe</td>
    </tr>
    <tr>
      <th>29</th>
      <td>2</td>
      <td>Jennifer Aniston</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2</td>
      <td>Catherine Zeta-Jones</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2</td>
      <td>Denzel Washington</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2</td>
      <td>Michael Fassbender</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2</td>
      <td>Angelina Jolie</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2</td>
      <td>Jessica Biel</td>
    </tr>
    <tr>
      <th>10</th>
      <td>3</td>
      <td>Global warming</td>
    </tr>
    <tr>
      <th>11</th>
      <td>3</td>
      <td>Nationally Appropriate Mitigation Action</td>
    </tr>
    <tr>
      <th>12</th>
      <td>3</td>
      <td>Nigel Lawson</td>
    </tr>
    <tr>
      <th>13</th>
      <td>3</td>
      <td>Connie Hedegaard</td>
    </tr>
    <tr>
      <th>14</th>
      <td>3</td>
      <td>Climate change</td>
    </tr>
    <tr>
      <th>15</th>
      <td>3</td>
      <td>Kyoto Protocol</td>
    </tr>
    <tr>
      <th>17</th>
      <td>3</td>
      <td>Greenhouse gas emissions by the United States</td>
    </tr>
    <tr>
      <th>18</th>
      <td>3</td>
      <td>2010 United Nations Climate Change Conference</td>
    </tr>
    <tr>
      <th>16</th>
      <td>3</td>
      <td>350.org</td>
    </tr>
    <tr>
      <th>19</th>
      <td>3</td>
      <td>2007 United Nations Climate Change Conference</td>
    </tr>
    <tr>
      <th>9</th>
      <td>4</td>
      <td>LinkedIn</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>Alexa Internet</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>Internet Explorer</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>HTTP cookie</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Google Search</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4</td>
      <td>Tumblr</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4</td>
      <td>Hypertext Transfer Protocol</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4</td>
      <td>Social search</td>
    </tr>
    <tr>
      <th>8</th>
      <td>4</td>
      <td>Firefox</td>
    </tr>
    <tr>
      <th>0</th>
      <td>4</td>
      <td>HTTP 404</td>
    </tr>
    <tr>
      <th>30</th>
      <td>5</td>
      <td>France national football team</td>
    </tr>
    <tr>
      <th>31</th>
      <td>5</td>
      <td>Cristiano Ronaldo</td>
    </tr>
    <tr>
      <th>32</th>
      <td>5</td>
      <td>Arsenal F.C.</td>
    </tr>
    <tr>
      <th>33</th>
      <td>5</td>
      <td>Radamel Falcao</td>
    </tr>
    <tr>
      <th>34</th>
      <td>5</td>
      <td>Zlatan Ibrahimović</td>
    </tr>
    <tr>
      <th>35</th>
      <td>5</td>
      <td>Colombia national football team</td>
    </tr>
    <tr>
      <th>36</th>
      <td>5</td>
      <td>2014 FIFA World Cup qualification</td>
    </tr>
    <tr>
      <th>37</th>
      <td>5</td>
      <td>Football</td>
    </tr>
    <tr>
      <th>38</th>
      <td>5</td>
      <td>Neymar</td>
    </tr>
    <tr>
      <th>39</th>
      <td>5</td>
      <td>Franck Ribéry</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="discovering-interpretable-features" class="level1">
<h1>Discovering interpretable features</h1>
<p>We’ll explore a dimension reduction technique called “Non-negative matrix factorization” (“NMF”) that expresses samples as combinations of interpretable parts. For example, it expresses documents as combinations of topics, and images in terms of commonly occurring visual patterns. We’ll also explore how to use NMF to build recommender systems that can find us similar articles to read, or musical artists that match your listening history!</p>
<section id="non-negative-matrix-factorization-nmf" class="level2">
<h2 class="anchored" data-anchor-id="non-negative-matrix-factorization-nmf">Non-negative matrix factorization (NMF)</h2>
<ul>
<li>NMF = “non-negative matrix factorization”</li>
<li>Dimension reduction technique</li>
<li>NMF models are interpretable (unlike PCA)</li>
<li>Easy to interpret means easy to explain!</li>
<li>However, all sample features must be non-negative (&gt;= 0)</li>
</ul>
<blockquote class="blockquote">
<h3 id="interpretable-parts" class="anchored">Interpretable parts</h3>
<ul>
<li>NMF expresses documents as combinations of topics (or “themes”)</li>
<li>NMF expresses images as combinations of patterns</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="using-scikit-learn-nmf" class="anchored">Using scikit-learn NMF</h3>
<ul>
<li>Follows <code>fit()</code> / <code>transform()</code> pattern</li>
<li>Must specify number of components e.g.&nbsp;<code>NMF(n_components=2)</code></li>
<li>Works with NumPy arrays and with <code>csr_matrix</code></li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="example-word-frequency-array" class="anchored">Example word-frequency array</h3>
<ul>
<li>Word frequency array, 4 words, many documents</li>
<li>Measure presence of words in each document using “tf-idf”</li>
<li>“tf” = frequency of word in document</li>
<li>“idf” reduces influence of frequent words</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="nmf-components" class="anchored">NMF components</h3>
<ul>
<li>NMF has components</li>
<li>… just like PCA has principal components</li>
<li>Dimension of components = dimension of samples</li>
<li>Entries are non-negative</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="nmf-features" class="anchored">NMF features</h3>
<ul>
<li>NMF feature values are non-negative</li>
<li>Can be used to reconstruct the samples</li>
<li>… combine feature values with components</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="sample-reconstruction" class="anchored">Sample reconstruction</h3>
<ul>
<li>Multiply components by feature values, and add up</li>
<li>Can also be expressed as a product of matrices</li>
<li>This is the “Matrix Factorization” in “NMF”</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="nmf-fits-to-non-negative-data-only" class="anchored">NMF fits to non-negative data, only</h3>
<ul>
<li>Word frequencies in each document</li>
<li>Images encoded as arrays</li>
<li>Audio spectrograms</li>
<li>Purchase histories on e-commerce sites</li>
<li>… and many more!</li>
</ul>
</blockquote>
<section id="non-negative-data" class="level3">
<h3 class="anchored" data-anchor-id="non-negative-data">Non-negative data</h3>
<ul>
<li>A tf-idf word-frequency array.</li>
<li>An array where rows are customers, columns are products and entries are 0 or 1, indicating whether a customer has purchased a product.</li>
</ul>
</section>
<section id="nmf-applied-to-wikipedia-articles" class="level3">
<h3 class="anchored" data-anchor-id="nmf-applied-to-wikipedia-articles">NMF applied to Wikipedia articles</h3>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an NMF instance: model</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>model_wp <span class="op">=</span> NMF(n_components<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model to articles</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>model_wp.fit(articles)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the articles: nmf_features</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>nmf_features_wp <span class="op">=</span> model_wp.transform(articles)</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the NMF features</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>nmf_features_wp[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<pre><code>array([[0.        , 0.        , 0.        , 0.        , 0.        ,
        0.44041429],
       [0.        , 0.        , 0.        , 0.        , 0.        ,
        0.56653905],
       [0.00382072, 0.        , 0.        , 0.        , 0.        ,
        0.39860038],
       [0.        , 0.        , 0.        , 0.        , 0.        ,
        0.3816956 ],
       [0.        , 0.        , 0.        , 0.        , 0.        ,
        0.48546058]])</code></pre>
</div>
</div>
</section>
<section id="nmf-features-of-the-wikipedia-articles" class="level3">
<h3 class="anchored" data-anchor-id="nmf-features-of-the-wikipedia-articles">NMF features of the Wikipedia articles</h3>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>When investigating the features, notice that for both actors, the NMF feature 3 has by far the highest value. This means that both articles are reconstructed using mainly the 3rd NMF component. We’ll see why: NMF components represent topics (for instance, acting!).</p>
</div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pandas DataFrame: df</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>wp_df <span class="op">=</span> pd.DataFrame(nmf_features_wp, index<span class="op">=</span>articles_titles)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the row for 'Anne Hathaway'</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>display(wp_df.loc[[<span class="st">'Anne Hathaway'</span>]])</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the row for 'Denzel Washington'</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>display(wp_df.loc[[<span class="st">'Denzel Washington'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Anne Hathaway</th>
      <td>0.003846</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.575735</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Denzel Washington</th>
      <td>0.0</td>
      <td>0.005601</td>
      <td>0.0</td>
      <td>0.422398</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="nmf-learns-interpretable-parts" class="level2">
<h2 class="anchored" data-anchor-id="nmf-learns-interpretable-parts">NMF learns interpretable parts</h2>
<blockquote class="blockquote">
<h3 id="example-nmf-learns-interpretable-parts" class="anchored">Example: NMF learns interpretable parts</h3>
<ul>
<li>Word-frequency array articles (tf-idf )</li>
<li>20,000 scientific articles (rows)</li>
<li>800 words (columns)</li>
</ul>
</blockquote>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>articles.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="83">
<pre><code>(60, 13125)</code></pre>
</div>
</div>
<p>NMF components are topics</p>
<blockquote class="blockquote">
<h3 id="nmf-components-1" class="anchored">NMF components</h3>
<ul>
<li>For documents:</li>
<li>NMF components represent topics</li>
<li>NMF features combine topics into documents</li>
<li>For images, NMF components are parts of images</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="grayscale-images" class="anchored">Grayscale images</h3>
<ul>
<li>“Grayscale” image = no colors, only shades of gray</li>
<li>Measure pixel brightness</li>
<li>Represent with value between 0 and 1 (0 is black)</li>
<li>Convert to 2D array</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="encoding-a-collection-of-images" class="anchored">Encoding a collection of images</h3>
<ul>
<li>Collection of images of the same size</li>
<li>Encode as 2D array</li>
<li>Each row corresponds to an image</li>
<li>Each column corresponds to a pixel</li>
<li>… can apply NMF!</li>
</ul>
</blockquote>
<section id="nmf-learns-topics-of-documents" class="level3">
<h3 class="anchored" data-anchor-id="nmf-learns-topics-of-documents">NMF learns topics of documents</h3>
<p>when NMF is applied to documents, the components correspond to topics of documents, and the NMF features reconstruct the documents from the topics. We will using the NMF model that we built earlier using the Wikipedia articles. 3rd NMF feature value was high for the articles about actors Anne Hathaway and Denzel Washington. We will identify the topic of the corresponding NMF component.</p>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>words <span class="op">=</span> pd.read_csv(<span class="st">"datasets/Wikipedia_articles/words.csv"</span>)[<span class="st">"0"</span>].to_list()</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>words[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>['aaron', 'abandon', 'abandoned', 'abandoning', 'abandonment']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame: components_df</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>components_df <span class="op">=</span> pd.DataFrame(model_wp.components_, columns<span class="op">=</span>words)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the shape of the DataFrame</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(components_df.shape)</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Select row 3: component</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>component <span class="op">=</span> components_df.iloc[<span class="dv">3</span>]</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print result of nlargest</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>component.nlargest()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(6, 13125)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="85">
<pre><code>film       0.627850
award      0.253121
starred    0.245274
role       0.211442
actress    0.186390
Name: 3, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="explore-the-led-digits-dataset" class="level3">
<h3 class="anchored" data-anchor-id="explore-the-led-digits-dataset">Explore the LED digits dataset</h3>
<p>We’ll use NMF to decompose grayscale images into their commonly occurring patterns. Firstly, we’ll explore the image dataset and see how it is encoded as an array.</p>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>samples_images <span class="op">=</span> pd.read_csv(<span class="st">"datasets/samples_images.csv"</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>samples_images.isnull().<span class="bu">sum</span>()</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>x[x<span class="op">&gt;</span><span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<pre><code>Series([], dtype: int64)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>samples_images<span class="op">=</span>samples_images.values</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>np.isinf(samples_images).<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>np.isnan(samples_images).<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the 0th row: digit</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>digit_i <span class="op">=</span> samples_images[<span class="dv">0</span>,:]</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print digit</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(digit_i)</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape digit to a 13x8 array: bitmap</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>bitmap_i <span class="op">=</span> digit_i.reshape(<span class="dv">13</span>,<span class="dv">8</span>)</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print bitmap</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bitmap_i)</span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Use plt.imshow to display bitmap</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>plt.imshow(bitmap_i, cmap<span class="op">=</span><span class="st">'gray'</span>, interpolation<span class="op">=</span><span class="st">'nearest'</span>)</span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 1. 1. 1. 1. 0. 0. 0. 0. 0. 0. 0. 0. 1. 0.
 0. 0. 0. 0. 0. 0. 1. 0. 0. 0. 0. 0. 0. 0. 1. 0. 0. 0. 0. 0. 0. 0. 1. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 1. 0. 0. 0. 0. 0. 0. 0. 1. 0.
 0. 0. 0. 0. 0. 0. 1. 0. 0. 0. 0. 0. 0. 0. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0.]
[[0. 0. 0. 0. 0. 0. 0. 0.]
 [0. 0. 1. 1. 1. 1. 0. 0.]
 [0. 0. 0. 0. 0. 0. 1. 0.]
 [0. 0. 0. 0. 0. 0. 1. 0.]
 [0. 0. 0. 0. 0. 0. 1. 0.]
 [0. 0. 0. 0. 0. 0. 1. 0.]
 [0. 0. 0. 0. 0. 0. 0. 0.]
 [0. 0. 0. 0. 0. 0. 1. 0.]
 [0. 0. 0. 0. 0. 0. 1. 0.]
 [0. 0. 0. 0. 0. 0. 1. 0.]
 [0. 0. 0. 0. 0. 0. 1. 0.]
 [0. 0. 0. 0. 0. 0. 0. 0.]
 [0. 0. 0. 0. 0. 0. 0. 0.]]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-80-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="nmf-learns-the-parts-of-images" class="level3">
<h3 class="anchored" data-anchor-id="nmf-learns-the-parts-of-images">NMF learns the parts of images</h3>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_as_image(sample):</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""displays the image encoded by any 1D array"""</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    bitmap <span class="op">=</span> sample.reshape((<span class="dv">13</span>, <span class="dv">8</span>))</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    plt.figure()</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>    plt.imshow(bitmap, cmap<span class="op">=</span><span class="st">'gray'</span>, interpolation<span class="op">=</span><span class="st">'nearest'</span>)</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>    plt.colorbar()</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>show_as_image(samples_images[<span class="dv">99</span>, :])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-82-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an NMF model: model</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>model_i <span class="op">=</span> NMF(n_components<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply fit_transform to samples: features</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>features_i <span class="op">=</span> model_i.fit_transform(samples_images)</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Call show_as_image on each component</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> component <span class="kw">in</span> model_i.components_:</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>    show_as_image(component)</span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the 0th row of features: digit_features</span></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>digit_features_i <span class="op">=</span> features_i[<span class="dv">0</span>,:]</span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print digit_features</span></span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a>digit_features_i</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-83-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-83-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-83-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-83-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-83-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-83-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-83-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="104">
<pre><code>array([4.76823559e-01, 0.00000000e+00, 0.00000000e+00, 5.90605054e-01,
       4.81559442e-01, 0.00000000e+00, 7.37535093e-16])</code></pre>
</div>
</div>
</section>
<section id="pca-doesnt-learn-parts" class="level3">
<h3 class="anchored" data-anchor-id="pca-doesnt-learn-parts">PCA doesn’t learn parts</h3>
<p>Unlike NMF, PCA doesn’t learn the parts of things. Its components do not correspond to topics (in the case of documents) or to parts of images, when trained on images. We will verify by inspecting the components of a PCA model fit to the dataset of LED digit images</p>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a PCA instance: model</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>model_i <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply fit_transform to samples: features</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>features_i <span class="op">=</span> model_i.fit_transform(samples_images)</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Call show_as_image on each component</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> component <span class="kw">in</span> model_i.components_:</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>    show_as_image(component)</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-84-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-84-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-84-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-84-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-84-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-84-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-07-14-Unsupervised Learning in Python_files/figure-html/cell-84-output-7.png" class="img-fluid"></p>
</div>
</div>
<p>the components of PCA do not represent meaningful parts of images of LED digits!</p>
</section>
</section>
<section id="building-recommender-systems-using-nmf" class="level2">
<h2 class="anchored" data-anchor-id="building-recommender-systems-using-nmf">Building recommender systems using NMF</h2>
<blockquote class="blockquote">
<h3 id="finding-similar-articles" class="anchored">Finding similar articles</h3>
<ul>
<li>Engineer at a large online newspaper</li>
<li>Task: recommend articles similar to article being read by customer</li>
<li>Similar articles should have similar topics</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="strategy" class="anchored">Strategy</h3>
<ul>
<li>Apply NMF to the word-frequency array</li>
<li>NMF feature values describe the topics</li>
<li>… so similar documents have similar NMF feature values</li>
<li>Compare NMF feature values?</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="versions-of-articles" class="anchored">Versions of articles</h3>
<ul>
<li>Different versions of the same document have same topic proportions</li>
<li>… exact feature values may be different!</li>
<li>E.g. because one version uses many meaningless words</li>
<li>But all versions lie on the same line through the origin</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<h3 id="cosine-similarity" class="anchored">Cosine similarity</h3>
<ul>
<li>Uses the angle between the lines</li>
<li>Higher values means more similar</li>
<li>Maximum value is 1, when angle is 0</li>
</ul>
</blockquote>
<section id="which-articles-are-similar-to-cristiano-ronaldo" class="level3">
<h3 class="anchored" data-anchor-id="which-articles-are-similar-to-cristiano-ronaldo">Which articles are similar to ‘Cristiano Ronaldo’?</h3>
<p>finding the articles most similar to the article about the footballer Cristiano Ronaldo.</p>
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize the NMF features: norm_features</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>norm_features_wp <span class="op">=</span> normalize(nmf_features_wp)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame: df</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>wp_df <span class="op">=</span> pd.DataFrame(norm_features_wp, index<span class="op">=</span>articles_titles)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the row corresponding to 'Cristiano Ronaldo': article</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>article <span class="op">=</span> wp_df.loc[<span class="st">'Cristiano Ronaldo'</span>]</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the dot products: similarities</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>similarities <span class="op">=</span> wp_df.dot(article)</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display those with the largest cosine similarity</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>similarities.nlargest()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<pre><code>Cristiano Ronaldo                1.000000
Franck Ribéry                    0.999972
Radamel Falcao                   0.999942
Zlatan Ibrahimović               0.999942
France national football team    0.999923
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="recommend-musical-artists-part-i" class="level3">
<h3 class="anchored" data-anchor-id="recommend-musical-artists-part-i">Recommend musical artists part I</h3>
<p>recommend popular music artists!</p>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>artists_df <span class="op">=</span> pd.read_csv(<span class="st">"datasets/Musical_artists/scrobbler-small-sample.csv"</span>)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>artists <span class="op">=</span> csr_matrix(artists_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a MaxAbsScaler: scaler</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> MaxAbsScaler()</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an NMF model: nmf</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>nmf <span class="op">=</span> NMF(n_components<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Normalizer: normalizer</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>normalizer <span class="op">=</span> Normalizer()</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pipeline: pipeline</span></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> make_pipeline(scaler, nmf, normalizer)</span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply fit_transform to artists: norm_features</span></span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>norm_features <span class="op">=</span> pipeline.fit_transform(artists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="recommend-musical-artists-part-ii" class="level3">
<h3 class="anchored" data-anchor-id="recommend-musical-artists-part-ii">Recommend musical artists part II</h3>
<p>Suppose you were a big fan of Bruce Springsteen - which other musicial artists might you like? We will use the NMF features and the cosine similarity to find similar musical artists.</p>
<div class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>artist_names <span class="op">=</span> pd.read_csv(<span class="st">"datasets/Musical_artists/artists.csv"</span>)[<span class="st">"0"</span>].to_list()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame: df</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(norm_features, index<span class="op">=</span>artist_names)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select row of 'Bruce Springsteen': artist</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>artist <span class="op">=</span> df.loc[<span class="st">'Bruce Springsteen'</span>]</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute cosine similarities: similarities</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>similarities <span class="op">=</span> df.dot(artist)</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display those with highest cosine similarity</span></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>similarities.nlargest()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ValueError: Shape of passed values is (2894, 20), indices imply (111, 20)</code></pre>
</div>
</div>
<p>{{ ‘Source: <a href="http://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_iris.html">http://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_iris.html</a>.’ | fndetail: 1 }} {{ ‘Source: <a href="https://archive.ics.uci.edu/ml/datasets/Wine">https://archive.ics.uci.edu/ml/datasets/Wine</a>.’ | fndetail: 2 }} {{ ‘These fish measurement data were sourced from the <a href="http://ww2.amstat.org/publications/jse/jse_data_archive.htm">Journal of Statistics Education.</a>.’ | fndetail: 3 }} {{ ‘Source: <a href="http://www.eurovision.tv/page/results">http://www.eurovision.tv/page/results</a>’ | fndetail: 4 }} {{ ‘The Wikipedia dataset you will be working with was obtained from <a href="https://blog.lateral.io/2015/06/the-unknown-perils-of-mining-wikipedia/">here</a>.’ | fndetail: 5 }}</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>