<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Victor Omondi">
<meta name="dcterms.date" content="2020-08-25">
<meta name="description" content="we’ll handle missing data without having to drop rows and columns using data on motor vehicle collisions released by New York City and published on the NYC OpenData website. There is data on over 1.5 million collisions dating back to 2012, with additional data continuously added. We’ll work with an extract of the full data: Crashes from the year 2018.">

<title>blog - Working with Missing Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/VictorOmondi1997"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/VictorOmondi197"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Working with Missing Data</h1>
                  <div>
        <div class="description">
          we’ll handle missing data without having to drop rows and columns using data on motor vehicle collisions released by New York City and published on the <a href="https://data.cityofnewyork.us/Public-Safety/NYPD-Motor-Vehicle-Collisions/h9gi-nx95">NYC OpenData website</a>. There is data on over 1.5 million collisions dating back to 2012, with additional data continuously added. We’ll work with an extract of the full data: Crashes from the year 2018.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">missing-data</div>
                <div class="quarto-category">data-analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Victor Omondi </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 25, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#libraries" id="toc-libraries" class="nav-link active" data-scroll-target="#libraries">Libraries</a>
  <ul class="collapse">
  <li><a href="#missing-values" id="toc-missing-values" class="nav-link" data-scroll-target="#missing-values">Missing Values</a></li>
  <li><a href="#verifying-the-total-columns" id="toc-verifying-the-total-columns" class="nav-link" data-scroll-target="#verifying-the-total-columns">Verifying the total columns</a></li>
  <li><a href="#filling-and-verifying-the-killed-and-the-injured-data" id="toc-filling-and-verifying-the-killed-and-the-injured-data" class="nav-link" data-scroll-target="#filling-and-verifying-the-killed-and-the-injured-data">Filling and Verifying the killed and the injured data</a></li>
  <li><a href="#visualizing-the-missing-data-with-plots" id="toc-visualizing-the-missing-data-with-plots" class="nav-link" data-scroll-target="#visualizing-the-missing-data-with-plots">Visualizing the missing data with plots</a></li>
  <li><a href="#analyzing-correlation-in-missing-values" id="toc-analyzing-correlation-in-missing-values" class="nav-link" data-scroll-target="#analyzing-correlation-in-missing-values">Analyzing Correlation in Missing Values</a></li>
  <li><a href="#finding-the-most-common-value-across-multiple-columns" id="toc-finding-the-most-common-value-across-multiple-columns" class="nav-link" data-scroll-target="#finding-the-most-common-value-across-multiple-columns">Finding The Most Common Value Across multiple Columns</a></li>
  <li><a href="#filling-unknow-values-with-a-placeholder" id="toc-filling-unknow-values-with-a-placeholder" class="nav-link" data-scroll-target="#filling-unknow-values-with-a-placeholder">Filling Unknow values with a placeholder</a></li>
  <li><a href="#missing-data-in-the-location-column" id="toc-missing-data-in-the-location-column" class="nav-link" data-scroll-target="#missing-data-in-the-location-column">Missing data in the “location” column</a></li>
  <li><a href="#imputing-location-data" id="toc-imputing-location-data" class="nav-link" data-scroll-target="#imputing-location-data">Imputing Location Data</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="libraries" class="level1">
<h1>Libraries</h1>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># to display all columns</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max.columns'</span>, <span class="va">None</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to display the entire contents of a cell</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_colwidth'</span>, <span class="va">None</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"ggplot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mvc <span class="op">=</span> pd.read_csv(<span class="st">"../datasets/nypd_mvc_2018.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>mvc.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unique_key</th>
      <th>date</th>
      <th>time</th>
      <th>borough</th>
      <th>location</th>
      <th>on_street</th>
      <th>cross_street</th>
      <th>off_street</th>
      <th>pedestrians_injured</th>
      <th>cyclist_injured</th>
      <th>motorist_injured</th>
      <th>total_injured</th>
      <th>pedestrians_killed</th>
      <th>cyclist_killed</th>
      <th>motorist_killed</th>
      <th>total_killed</th>
      <th>vehicle_1</th>
      <th>vehicle_2</th>
      <th>vehicle_3</th>
      <th>vehicle_4</th>
      <th>vehicle_5</th>
      <th>cause_vehicle_1</th>
      <th>cause_vehicle_2</th>
      <th>cause_vehicle_3</th>
      <th>cause_vehicle_4</th>
      <th>cause_vehicle_5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3869058</td>
      <td>2018-03-23</td>
      <td>21:40</td>
      <td>MANHATTAN</td>
      <td>(40.742832, -74.00771)</td>
      <td>WEST 15 STREET</td>
      <td>10 AVENUE</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>PASSENGER VEHICLE</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Following Too Closely</td>
      <td>Unspecified</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3847947</td>
      <td>2018-02-13</td>
      <td>14:45</td>
      <td>BROOKLYN</td>
      <td>(40.623714, -73.99314)</td>
      <td>16 AVENUE</td>
      <td>62 STREET</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>SPORT UTILITY / STATION WAGON</td>
      <td>DS</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Backing Unsafely</td>
      <td>Unspecified</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3914294</td>
      <td>2018-06-04</td>
      <td>0:00</td>
      <td>NaN</td>
      <td>(40.591755, -73.9083)</td>
      <td>BELT PARKWAY</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>Station Wagon/Sport Utility Vehicle</td>
      <td>Sedan</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Following Too Closely</td>
      <td>Unspecified</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3915069</td>
      <td>2018-06-05</td>
      <td>6:36</td>
      <td>QUEENS</td>
      <td>(40.73602, -73.87954)</td>
      <td>GRAND AVENUE</td>
      <td>VANLOON STREET</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>Sedan</td>
      <td>Sedan</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Glare</td>
      <td>Passing Too Closely</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3923123</td>
      <td>2018-06-16</td>
      <td>15:45</td>
      <td>BRONX</td>
      <td>(40.884727, -73.89945)</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>208       WEST 238 STREET</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>Station Wagon/Sport Utility Vehicle</td>
      <td>Sedan</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Turning Improperly</td>
      <td>Unspecified</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>A summary of the columns and their data is below:</p>
<ul>
<li><strong><code>unique_key</code></strong>: A unique identifier for each collision.</li>
<li><strong><code>date, time</code></strong>: Date and time of the collision.</li>
<li><strong><code>borough</code></strong>: The borough, or area of New York City, where the collision occurred.</li>
<li><strong><code>location</code></strong>: Latitude and longitude coordinates for the collision.</li>
<li><strong><code>on_street, cross_street, off_street</code></strong>: Details of the street or intersection where the collision occurred.</li>
<li><strong><code>pedestrians_injured</code></strong>: Number of pedestrians who were injured.</li>
<li><strong><code>cyclist_injured</code></strong>: Number of people traveling on a bicycle who were injured.</li>
<li><strong><code>motorist_injured</code></strong>: Number of people traveling in a vehicle who were injured.</li>
<li><strong><code>total_injured</code></strong>: Total number of people injured.</li>
<li><strong><code>pedestrians_killed</code></strong>: Number of pedestrians who were killed.</li>
<li><strong><code>cyclist_killed</code></strong>: Number of people traveling on a bicycle who were killed.</li>
<li><strong><code>motorist_killed</code></strong>: Number of people traveling in a vehicle who were killed.</li>
<li><strong><code>total_killed</code></strong>: Total number of people killed.</li>
<li><strong><code>vehicle_1 through vehicle_5</code></strong>: Type of each vehicle involved in the accident.</li>
<li><strong><code>cause_vehicle_1 through cause_vehicle_5</code></strong>: Contributing factor for each vehicle in the accident.</li>
</ul>
<section id="missing-values" class="level2">
<h2 class="anchored" data-anchor-id="missing-values">Missing Values</h2>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mvc.isna().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>unique_key                 0
date                       0
time                       0
borough                20646
location                3885
on_street              13961
cross_street           29249
off_street             44093
pedestrians_injured        0
cyclist_injured            0
motorist_injured           0
total_injured              1
pedestrians_killed         0
cyclist_killed             0
motorist_killed            0
total_killed               5
vehicle_1                355
vehicle_2              12262
vehicle_3              54352
vehicle_4              57158
vehicle_5              57681
cause_vehicle_1          175
cause_vehicle_2         8692
cause_vehicle_3        54134
cause_vehicle_4        57111
cause_vehicle_5        57671
dtype: int64</code></pre>
</div>
</div>
<p>To give us a better picture of the null values in the data, let’s calculate the percentage of null values in each column.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>null_df <span class="op">=</span> pd.DataFrame({<span class="st">'null_counts'</span>:mvc.isna().<span class="bu">sum</span>(), <span class="st">'null_pct'</span>:mvc.isna().<span class="bu">sum</span>()<span class="op">/</span>mvc.shape[<span class="dv">0</span>] <span class="op">*</span> <span class="dv">100</span>}).T.astype(<span class="bu">int</span>).T</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>null_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>null_counts</th>
      <th>null_pct</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>unique_key</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>date</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>time</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>borough</th>
      <td>20646</td>
      <td>35</td>
    </tr>
    <tr>
      <th>location</th>
      <td>3885</td>
      <td>6</td>
    </tr>
    <tr>
      <th>on_street</th>
      <td>13961</td>
      <td>24</td>
    </tr>
    <tr>
      <th>cross_street</th>
      <td>29249</td>
      <td>50</td>
    </tr>
    <tr>
      <th>off_street</th>
      <td>44093</td>
      <td>76</td>
    </tr>
    <tr>
      <th>pedestrians_injured</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>cyclist_injured</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>motorist_injured</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>total_injured</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>pedestrians_killed</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>cyclist_killed</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>motorist_killed</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>total_killed</th>
      <td>5</td>
      <td>0</td>
    </tr>
    <tr>
      <th>vehicle_1</th>
      <td>355</td>
      <td>0</td>
    </tr>
    <tr>
      <th>vehicle_2</th>
      <td>12262</td>
      <td>21</td>
    </tr>
    <tr>
      <th>vehicle_3</th>
      <td>54352</td>
      <td>93</td>
    </tr>
    <tr>
      <th>vehicle_4</th>
      <td>57158</td>
      <td>98</td>
    </tr>
    <tr>
      <th>vehicle_5</th>
      <td>57681</td>
      <td>99</td>
    </tr>
    <tr>
      <th>cause_vehicle_1</th>
      <td>175</td>
      <td>0</td>
    </tr>
    <tr>
      <th>cause_vehicle_2</th>
      <td>8692</td>
      <td>15</td>
    </tr>
    <tr>
      <th>cause_vehicle_3</th>
      <td>54134</td>
      <td>93</td>
    </tr>
    <tr>
      <th>cause_vehicle_4</th>
      <td>57111</td>
      <td>98</td>
    </tr>
    <tr>
      <th>cause_vehicle_5</th>
      <td>57671</td>
      <td>99</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>About a third of the columns have no null values, with the rest ranging from less than 1% to 99%! To make things easier, let’s start by looking at the group of columns that relate to people killed in collisions.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>null_df.loc[[column <span class="cf">for</span> column <span class="kw">in</span> mvc.columns <span class="cf">if</span> <span class="st">"killed"</span> <span class="kw">in</span> column]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>null_counts</th>
      <th>null_pct</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>pedestrians_killed</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>cyclist_killed</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>motorist_killed</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>total_killed</th>
      <td>5</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We can see that each of the individual categories have no missing values, but the <code>total_killed</code> column has five missing values.</p>
<p>If you think about it, the total number of people killed should be the sum of each of the individual categories. We might be able to “fill in” the missing values with the sums of the individual columns for that row.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The technical name for filling in a missing value with a replacement value is called <strong>imputation</strong>.</p>
</div>
</div>
</section>
<section id="verifying-the-total-columns" class="level2">
<h2 class="anchored" data-anchor-id="verifying-the-total-columns">Verifying the total columns</h2>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>killed <span class="op">=</span> mvc[[col <span class="cf">for</span> col <span class="kw">in</span> mvc.columns <span class="cf">if</span> <span class="st">'killed'</span> <span class="kw">in</span> col]].copy()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>killed_manual_sum <span class="op">=</span> killed.iloc[:, :<span class="dv">3</span>].<span class="bu">sum</span>(axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>killed_mask <span class="op">=</span> killed_manual_sum <span class="op">!=</span> killed.total_killed</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>killed_non_eq <span class="op">=</span> killed[killed_mask]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>killed_non_eq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>pedestrians_killed</th>
      <th>cyclist_killed</th>
      <th>motorist_killed</th>
      <th>total_killed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3508</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>20163</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>22046</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>48719</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>55148</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>55699</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="filling-and-verifying-the-killed-and-the-injured-data" class="level2">
<h2 class="anchored" data-anchor-id="filling-and-verifying-the-killed-and-the-injured-data">Filling and Verifying the killed and the injured data</h2>
<p>The <code>killed_non_eq</code> dataframe has six rows. We can categorize these into two categories:</p>
<ul>
<li>Five rows where the <code>total_killed</code> is not equal to the sum of the other columns because the total value is missing.</li>
<li>One row where the <code>total_killed</code> is less than the sum of the other columns.</li>
</ul>
<p>From this, we can conclude that filling null values with the sum of the columns is a fairly good choice for our imputation, given that only six rows out of around 58,000 don’t match this pattern.</p>
<p>We’ve also identified a row that has suspicious data - one that doesn’t sum correctly. Once we have imputed values for all rows with missing values for <code>total_killed</code>, we’ll mark this suspect row by setting its value to <code>NaN</code>.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fix the killed values</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>killed[<span class="st">'total_killed'</span>] <span class="op">=</span> killed[<span class="st">'total_killed'</span>].mask(killed[<span class="st">'total_killed'</span>].isnull(), killed_manual_sum)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>killed[<span class="st">'total_killed'</span>] <span class="op">=</span> killed[<span class="st">'total_killed'</span>].mask(killed[<span class="st">'total_killed'</span>] <span class="op">!=</span> killed_manual_sum, np.nan)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an injured dataframe and manually sum values</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>injured <span class="op">=</span> mvc[[col <span class="cf">for</span> col <span class="kw">in</span> mvc.columns <span class="cf">if</span> <span class="st">'injured'</span> <span class="kw">in</span> col]].copy()</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>injured_manual_sum <span class="op">=</span> injured.iloc[:,:<span class="dv">3</span>].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>injured[<span class="st">'total_injured'</span>] <span class="op">=</span> injured.total_injured.mask(injured.total_injured.isnull(), injured_manual_sum)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>injured[<span class="st">'total_injured'</span>] <span class="op">=</span> injured.total_injured.mask(injured.total_injured <span class="op">!=</span> injured_manual_sum, np.nan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s summarize the count of null values before and after our changes:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'injured'</span>: [</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        mvc[<span class="st">'total_injured'</span>].isnull().<span class="bu">sum</span>(),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        injured[<span class="st">'total_injured'</span>].isnull().<span class="bu">sum</span>()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'killed'</span>: [</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        mvc[<span class="st">'total_killed'</span>].isnull().<span class="bu">sum</span>(),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        killed[<span class="st">'total_killed'</span>].isnull().<span class="bu">sum</span>()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(summary, index<span class="op">=</span>[<span class="st">'before'</span>,<span class="st">'after'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>injured</th>
      <th>killed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>before</th>
      <td>1</td>
      <td>5</td>
    </tr>
    <tr>
      <th>after</th>
      <td>21</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>For the <code>total_killed</code> column, the number of values has gone down from 5 to 1. For the <code>total_injured</code> column, the number of values has actually gone up — from 1 to 21. This might sound like we’ve done the opposite of what we set out to do, but what we’ve actually done is fill all the null values and identify values that have suspect data. This will make any analysis we do on this data more accurate in the long run.</p>
<p>Let’s assign the values from the <code>killed</code> and <code>injured</code> dataframe back to the main <code>mvc</code> dataframe:</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mvc[<span class="st">'total_injured'</span>]<span class="op">=</span>injured.total_injured</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mvc[<span class="st">'total_killed'</span>]<span class="op">=</span>killed.total_killed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizing-the-missing-data-with-plots" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-the-missing-data-with-plots">Visualizing the missing data with plots</h2>
<p>Earlier, we used a table of numbers to understand the number of missing values in our dataframe. A different approach we can take is to use a plot to visualize the missing values. The function below uses <code>seaborn.heatmap()</code> to represent null values as dark squares and non-null values as light squares:</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_null_matrix(df, figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">15</span>)):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Plot null values as light squares and non-null values as dark squares"""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>figsize)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    df_null <span class="op">=</span> df.isnull()</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(<span class="op">~</span>df_null, cbar<span class="op">=</span><span class="va">False</span>, yticklabels<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="st">"x-large"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s look at how the function works by using it to plot just the first row of our <code>mvc</code> dataframe. We’ll display the first row as a table immediately below so it’s easy to compare:</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>plot_null_matrix(mvc.head(<span class="dv">1</span>), figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-08-25-Working with Missing Data_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mvc.head(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unique_key</th>
      <th>date</th>
      <th>time</th>
      <th>borough</th>
      <th>location</th>
      <th>on_street</th>
      <th>cross_street</th>
      <th>off_street</th>
      <th>pedestrians_injured</th>
      <th>cyclist_injured</th>
      <th>motorist_injured</th>
      <th>total_injured</th>
      <th>pedestrians_killed</th>
      <th>cyclist_killed</th>
      <th>motorist_killed</th>
      <th>total_killed</th>
      <th>vehicle_1</th>
      <th>vehicle_2</th>
      <th>vehicle_3</th>
      <th>vehicle_4</th>
      <th>vehicle_5</th>
      <th>cause_vehicle_1</th>
      <th>cause_vehicle_2</th>
      <th>cause_vehicle_3</th>
      <th>cause_vehicle_4</th>
      <th>cause_vehicle_5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3869058</td>
      <td>2018-03-23</td>
      <td>21:40</td>
      <td>MANHATTAN</td>
      <td>(40.742832, -74.00771)</td>
      <td>WEST 15 STREET</td>
      <td>10 AVENUE</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>PASSENGER VEHICLE</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Following Too Closely</td>
      <td>Unspecified</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Each value is represented by a light square, and each missing value is represented by a dark square.</p>
<p>Let’s look at what a plot matrix looks like for the whole dataframe:</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plot_null_matrix(mvc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-08-25-Working with Missing Data_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We can make some immediate interpretations about our dataframe:</p>
<ul>
<li>The first three columns have few to no missing values.</li>
<li>The next five columns have missing values scattered throughout, with each column seeming to have its own density of missing values.</li>
<li>The next eight columns are the <code>injury</code> and <code>killed</code> columns we just cleaned, and only have a few missing values.</li>
<li>The last 10 columns seem to break into two groups of five, with each group of five having similar patterns of null/non-null values.</li>
</ul>
<p>Let’s examine the pattern in the last 10 columns a little more closely. We can calculate the relationship between two sets of columns, known as <strong>correlation</strong>.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>cols_with_missing_vals <span class="op">=</span> mvc.columns[mvc.isnull().<span class="bu">sum</span>()<span class="op">&gt;</span><span class="dv">0</span>]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>missing_corr <span class="op">=</span> mvc[cols_with_missing_vals].isnull().corr()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>missing_corr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>borough</th>
      <th>location</th>
      <th>on_street</th>
      <th>cross_street</th>
      <th>off_street</th>
      <th>total_injured</th>
      <th>total_killed</th>
      <th>vehicle_1</th>
      <th>vehicle_2</th>
      <th>vehicle_3</th>
      <th>vehicle_4</th>
      <th>vehicle_5</th>
      <th>cause_vehicle_1</th>
      <th>cause_vehicle_2</th>
      <th>cause_vehicle_3</th>
      <th>cause_vehicle_4</th>
      <th>cause_vehicle_5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>borough</th>
      <td>1.000000</td>
      <td>0.190105</td>
      <td>-0.350190</td>
      <td>0.409107</td>
      <td>0.362189</td>
      <td>-0.002827</td>
      <td>0.005582</td>
      <td>-0.018325</td>
      <td>-0.077516</td>
      <td>-0.061932</td>
      <td>-0.020406</td>
      <td>-0.010733</td>
      <td>-0.012115</td>
      <td>-0.058596</td>
      <td>-0.060542</td>
      <td>-0.020158</td>
      <td>-0.011348</td>
    </tr>
    <tr>
      <th>location</th>
      <td>0.190105</td>
      <td>1.000000</td>
      <td>-0.073975</td>
      <td>-0.069719</td>
      <td>0.084579</td>
      <td>-0.001486</td>
      <td>0.015496</td>
      <td>-0.010466</td>
      <td>-0.033842</td>
      <td>-0.000927</td>
      <td>0.004655</td>
      <td>-0.005797</td>
      <td>-0.003458</td>
      <td>-0.021373</td>
      <td>0.000684</td>
      <td>0.004604</td>
      <td>-0.004841</td>
    </tr>
    <tr>
      <th>on_street</th>
      <td>-0.350190</td>
      <td>-0.073975</td>
      <td>1.000000</td>
      <td>0.557767</td>
      <td>-0.991030</td>
      <td>0.006220</td>
      <td>-0.002344</td>
      <td>-0.001889</td>
      <td>0.119647</td>
      <td>0.020867</td>
      <td>0.004172</td>
      <td>-0.002768</td>
      <td>0.001307</td>
      <td>0.087374</td>
      <td>0.017426</td>
      <td>0.002737</td>
      <td>-0.003107</td>
    </tr>
    <tr>
      <th>cross_street</th>
      <td>0.409107</td>
      <td>-0.069719</td>
      <td>0.557767</td>
      <td>1.000000</td>
      <td>-0.552763</td>
      <td>0.002513</td>
      <td>0.004112</td>
      <td>-0.017018</td>
      <td>0.043799</td>
      <td>-0.049910</td>
      <td>-0.021137</td>
      <td>-0.012003</td>
      <td>-0.009102</td>
      <td>0.031189</td>
      <td>-0.052159</td>
      <td>-0.022074</td>
      <td>-0.013455</td>
    </tr>
    <tr>
      <th>off_street</th>
      <td>0.362189</td>
      <td>0.084579</td>
      <td>-0.991030</td>
      <td>-0.552763</td>
      <td>1.000000</td>
      <td>-0.004266</td>
      <td>0.002323</td>
      <td>0.001812</td>
      <td>-0.121129</td>
      <td>-0.022404</td>
      <td>-0.004074</td>
      <td>0.002492</td>
      <td>-0.001738</td>
      <td>-0.088187</td>
      <td>-0.019120</td>
      <td>-0.002580</td>
      <td>0.002863</td>
    </tr>
    <tr>
      <th>total_injured</th>
      <td>-0.002827</td>
      <td>-0.001486</td>
      <td>0.006220</td>
      <td>0.002513</td>
      <td>-0.004266</td>
      <td>1.000000</td>
      <td>-0.000079</td>
      <td>0.079840</td>
      <td>0.025644</td>
      <td>-0.002757</td>
      <td>0.002118</td>
      <td>0.001073</td>
      <td>0.131140</td>
      <td>0.030082</td>
      <td>-0.002388</td>
      <td>0.002188</td>
      <td>0.001102</td>
    </tr>
    <tr>
      <th>total_killed</th>
      <td>0.005582</td>
      <td>0.015496</td>
      <td>-0.002344</td>
      <td>0.004112</td>
      <td>0.002323</td>
      <td>-0.000079</td>
      <td>1.000000</td>
      <td>-0.000327</td>
      <td>0.008017</td>
      <td>0.001057</td>
      <td>0.000462</td>
      <td>0.000234</td>
      <td>-0.000229</td>
      <td>0.009888</td>
      <td>0.001091</td>
      <td>0.000477</td>
      <td>0.000240</td>
    </tr>
    <tr>
      <th>vehicle_1</th>
      <td>-0.018325</td>
      <td>-0.010466</td>
      <td>-0.001889</td>
      <td>-0.017018</td>
      <td>0.001812</td>
      <td>0.079840</td>
      <td>-0.000327</td>
      <td>1.000000</td>
      <td>0.151516</td>
      <td>0.019972</td>
      <td>0.008732</td>
      <td>0.004425</td>
      <td>0.604281</td>
      <td>0.180678</td>
      <td>0.020624</td>
      <td>0.009022</td>
      <td>0.004545</td>
    </tr>
    <tr>
      <th>vehicle_2</th>
      <td>-0.077516</td>
      <td>-0.033842</td>
      <td>0.119647</td>
      <td>0.043799</td>
      <td>-0.121129</td>
      <td>0.025644</td>
      <td>0.008017</td>
      <td>0.151516</td>
      <td>1.000000</td>
      <td>0.131813</td>
      <td>0.057631</td>
      <td>0.029208</td>
      <td>0.106214</td>
      <td>0.784402</td>
      <td>0.132499</td>
      <td>0.058050</td>
      <td>0.029264</td>
    </tr>
    <tr>
      <th>vehicle_3</th>
      <td>-0.061932</td>
      <td>-0.000927</td>
      <td>0.020867</td>
      <td>-0.049910</td>
      <td>-0.022404</td>
      <td>-0.002757</td>
      <td>0.001057</td>
      <td>0.019972</td>
      <td>0.131813</td>
      <td>1.000000</td>
      <td>0.437214</td>
      <td>0.221585</td>
      <td>0.014000</td>
      <td>0.106874</td>
      <td>0.961316</td>
      <td>0.448525</td>
      <td>0.225067</td>
    </tr>
    <tr>
      <th>vehicle_4</th>
      <td>-0.020406</td>
      <td>0.004655</td>
      <td>0.004172</td>
      <td>-0.021137</td>
      <td>-0.004074</td>
      <td>0.002118</td>
      <td>0.000462</td>
      <td>0.008732</td>
      <td>0.057631</td>
      <td>0.437214</td>
      <td>1.000000</td>
      <td>0.506810</td>
      <td>0.006121</td>
      <td>0.046727</td>
      <td>0.423394</td>
      <td>0.963723</td>
      <td>0.515058</td>
    </tr>
    <tr>
      <th>vehicle_5</th>
      <td>-0.010733</td>
      <td>-0.005797</td>
      <td>-0.002768</td>
      <td>-0.012003</td>
      <td>0.002492</td>
      <td>0.001073</td>
      <td>0.000234</td>
      <td>0.004425</td>
      <td>0.029208</td>
      <td>0.221585</td>
      <td>0.506810</td>
      <td>1.000000</td>
      <td>0.003102</td>
      <td>0.023682</td>
      <td>0.214580</td>
      <td>0.490537</td>
      <td>0.973664</td>
    </tr>
    <tr>
      <th>cause_vehicle_1</th>
      <td>-0.012115</td>
      <td>-0.003458</td>
      <td>0.001307</td>
      <td>-0.009102</td>
      <td>-0.001738</td>
      <td>0.131140</td>
      <td>-0.000229</td>
      <td>0.604281</td>
      <td>0.106214</td>
      <td>0.014000</td>
      <td>0.006121</td>
      <td>0.003102</td>
      <td>1.000000</td>
      <td>0.131000</td>
      <td>0.014457</td>
      <td>0.006324</td>
      <td>0.003186</td>
    </tr>
    <tr>
      <th>cause_vehicle_2</th>
      <td>-0.058596</td>
      <td>-0.021373</td>
      <td>0.087374</td>
      <td>0.031189</td>
      <td>-0.088187</td>
      <td>0.030082</td>
      <td>0.009888</td>
      <td>0.180678</td>
      <td>0.784402</td>
      <td>0.106874</td>
      <td>0.046727</td>
      <td>0.023682</td>
      <td>0.131000</td>
      <td>1.000000</td>
      <td>0.110362</td>
      <td>0.048277</td>
      <td>0.024322</td>
    </tr>
    <tr>
      <th>cause_vehicle_3</th>
      <td>-0.060542</td>
      <td>0.000684</td>
      <td>0.017426</td>
      <td>-0.052159</td>
      <td>-0.019120</td>
      <td>-0.002388</td>
      <td>0.001091</td>
      <td>0.020624</td>
      <td>0.132499</td>
      <td>0.961316</td>
      <td>0.423394</td>
      <td>0.214580</td>
      <td>0.014457</td>
      <td>0.110362</td>
      <td>1.000000</td>
      <td>0.437440</td>
      <td>0.220384</td>
    </tr>
    <tr>
      <th>cause_vehicle_4</th>
      <td>-0.020158</td>
      <td>0.004604</td>
      <td>0.002737</td>
      <td>-0.022074</td>
      <td>-0.002580</td>
      <td>0.002188</td>
      <td>0.000477</td>
      <td>0.009022</td>
      <td>0.058050</td>
      <td>0.448525</td>
      <td>0.963723</td>
      <td>0.490537</td>
      <td>0.006324</td>
      <td>0.048277</td>
      <td>0.437440</td>
      <td>1.000000</td>
      <td>0.503805</td>
    </tr>
    <tr>
      <th>cause_vehicle_5</th>
      <td>-0.011348</td>
      <td>-0.004841</td>
      <td>-0.003107</td>
      <td>-0.013455</td>
      <td>0.002863</td>
      <td>0.001102</td>
      <td>0.000240</td>
      <td>0.004545</td>
      <td>0.029264</td>
      <td>0.225067</td>
      <td>0.515058</td>
      <td>0.973664</td>
      <td>0.003186</td>
      <td>0.024322</td>
      <td>0.220384</td>
      <td>0.503805</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Each value is between -1 and 1, and represents the relationship between two columns. A number close to 1 or -1 represents a strong relationship, where a number in the middle (close to 0) represents a weak relationship.</p>
<p>If you look closely, you can see a diagonal line of 1s going from top left to bottom right. These values represent each columns relationship with itself, which of course is a perfect relationship. The values on the top/right of this “line of 1s” mirror the values on the bottom/left of this line: The table actually repeats every value twice!</p>
<p>Let’s create a correlation plot of just those last 10 columns to see if we can more closely identify the pattern we saw earlier in the matrix plot.</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_null_correlations(df):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""create a correlation matrix only for columns with at least one missing value"""</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    cols_with_missing_vals <span class="op">=</span> df.columns[df.isnull().<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    missing_corr <span class="op">=</span> df[cols_with_missing_vals].isnull().corr()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create a mask to avoid repeated values and make</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the plot easier to read</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    missing_corr <span class="op">=</span> missing_corr.iloc[<span class="dv">1</span>:, :<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.triu(np.ones_like(missing_corr), k<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot a heatmap of the values</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">14</span>))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> sns.heatmap(missing_corr, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, cbar<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>                     cmap<span class="op">=</span><span class="st">'RdBu'</span>, mask<span class="op">=</span>mask, annot<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># format the text in the plot to make it easier to read</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> text <span class="kw">in</span> ax.texts:</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="bu">float</span>(text.get_text())</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">-</span><span class="fl">0.05</span> <span class="op">&lt;</span> t <span class="op">&lt;</span> <span class="fl">0.01</span>:</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>            text.set_text(<span class="st">''</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>            text.set_text(<span class="bu">round</span>(t, <span class="dv">2</span>))</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        text.set_fontsize(<span class="st">'x-large'</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>, size<span class="op">=</span><span class="st">'x-large'</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    plt.yticks(rotation<span class="op">=</span><span class="dv">0</span>, size<span class="op">=</span><span class="st">'x-large'</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plot_null_correlations(mvc[[column <span class="cf">for</span> column <span class="kw">in</span> mvc.columns <span class="cf">if</span> <span class="st">'vehicle'</span> <span class="kw">in</span> column]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-08-25-Working with Missing Data_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>In our correlation plot:</p>
<ul>
<li>The “line of 1s” and the repeated values are removed so that it’s not visually overwhelming.</li>
<li>Values very close to 0, where there is little to no relationship, aren’t labeled.</li>
<li>Values close to 1 are dark blue and values close to -1 are light blue — the depth of color represents the strength of the relationship.</li>
</ul>
</section>
<section id="analyzing-correlation-in-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-correlation-in-missing-values">Analyzing Correlation in Missing Values</h2>
<p>When a vehicle is in an accident, there is likely to be a cause, and vice-versa.</p>
<p>Let’s explore the variations in missing values from these five pairs of columns. We’ll create a dataframe that counts, for each pair:</p>
<ul>
<li>The number of values where the vehicle is missing when the cause is not missing.</li>
<li>The number of values where the cause is missing when the vehicle is not missing.</li>
</ul>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>col_labels <span class="op">=</span> [<span class="st">'v_number'</span>, <span class="st">'vehicle_missing'</span>, <span class="st">'cause_missing'</span>]</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>vc_null_data <span class="op">=</span> []</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> v <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>):</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    v_col <span class="op">=</span> <span class="st">'vehicle_</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(v)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    c_col <span class="op">=</span> <span class="st">'cause_vehicle_</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(v)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    v_null <span class="op">=</span> mvc[mvc[v_col].isnull() <span class="op">&amp;</span> mvc[c_col].notnull()].shape[<span class="dv">0</span>]</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    c_null <span class="op">=</span> mvc[mvc[v_col].notnull() <span class="op">&amp;</span> mvc[c_col].isnull()].shape[<span class="dv">0</span>]</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    vc_null_data.append([v, v_null, c_null])</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>vc_null_df <span class="op">=</span> pd.DataFrame(vc_null_data, columns<span class="op">=</span>col_labels)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>vc_null_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>v_number</th>
      <th>vehicle_missing</th>
      <th>cause_missing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>204</td>
      <td>24</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>3793</td>
      <td>223</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>242</td>
      <td>24</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>50</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>10</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="finding-the-most-common-value-across-multiple-columns" class="level2">
<h2 class="anchored" data-anchor-id="finding-the-most-common-value-across-multiple-columns">Finding The Most Common Value Across multiple Columns</h2>
<p>The analysis we indicates that there are roughly 4,500 missing values across the 10 columns. The easiest option for handling these would be to drop the rows with missing values. This would mean losing almost 10% of the total data, which is something we ideally want to avoid.</p>
<p>A better option is to impute the data, like we did earlier. Because the data in these columns is text data, we can’t perform a numeric calculation to impute missing data.</p>
<p>One common option when imputing is to use the most common value to fill in data. Let’s look at the common values across these columns and see if we can use that to make a decision.</p>
<p>Let’s count the most common values for the cause set of columns. We’ll start by selecting only the columns containing the substring <code>cause</code>.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>cause <span class="op">=</span> mvc[[c <span class="cf">for</span> c <span class="kw">in</span> mvc.columns <span class="cf">if</span> <span class="st">"cause_"</span> <span class="kw">in</span> c]]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>cause.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>cause_vehicle_1</th>
      <th>cause_vehicle_2</th>
      <th>cause_vehicle_3</th>
      <th>cause_vehicle_4</th>
      <th>cause_vehicle_5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Following Too Closely</td>
      <td>Unspecified</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Backing Unsafely</td>
      <td>Unspecified</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Following Too Closely</td>
      <td>Unspecified</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Glare</td>
      <td>Passing Too Closely</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Turning Improperly</td>
      <td>Unspecified</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Next, we’ll stack the values into a single series object:</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>cause_1d <span class="op">=</span> cause.stack()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>cause_1d.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>0  cause_vehicle_1    Following Too Closely
   cause_vehicle_2              Unspecified
1  cause_vehicle_1         Backing Unsafely
   cause_vehicle_2              Unspecified
2  cause_vehicle_1    Following Too Closely
dtype: object</code></pre>
</div>
</div>
<p>You may notice that the stacked version omits null values - this is fine, as we’re just interested in the most common non-null values.</p>
<p>Finally, we count the values in the series:</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>cause_counts <span class="op">=</span> cause_1d.value_counts()</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>top10_causes <span class="op">=</span> cause_counts.head(<span class="dv">10</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>top10_causes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>Unspecified                       57481
Driver Inattention/Distraction    17650
Following Too Closely              6567
Failure to Yield Right-of-Way      4566
Passing or Lane Usage Improper     3260
Passing Too Closely                3045
Backing Unsafely                   3001
Other Vehicular                    2523
Unsafe Lane Changing               2372
Turning Improperly                 1590
dtype: int64</code></pre>
</div>
</div>
<p>The most common non-null value for the cause columns is <code>Unspecified</code>, which presumably indicates that the officer reporting the collision was unable to determine the cause for that vehicle.</p>
<p>Let’s identify the most common non-null value for the vehicle columns.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>v_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> mvc.columns <span class="cf">if</span> c.startswith(<span class="st">"vehicle"</span>)]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>top10_vehicles <span class="op">=</span> mvc[v_cols].stack().value_counts().head(<span class="dv">10</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>top10_vehicles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>Sedan                                  33133
Station Wagon/Sport Utility Vehicle    26124
PASSENGER VEHICLE                      16026
SPORT UTILITY / STATION WAGON          12356
Taxi                                    3482
Pick-up Truck                           2373
TAXI                                    1892
Box Truck                               1659
Bike                                    1190
Bus                                     1162
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="filling-unknow-values-with-a-placeholder" class="level2">
<h2 class="anchored" data-anchor-id="filling-unknow-values-with-a-placeholder">Filling Unknow values with a placeholder</h2>
<p>The top “cause” is an <code>"Unspecified"</code> placeholder. This is useful instead of a null value as it makes the distinction between a value that is missing because there were only a certain number of vehicles in the collision versus one that is because the contributing cause for a particular vehicle is unknown.</p>
<p>The vehicles columns don’t have an equivalent, but we can still use the same technique. Here’s the logic we’ll need to do for each pair of vehicle/cause columns:</p>
<ul>
<li>For values where the vehicle is null and the cause is non-null, set the vehicle to <code>Unspecified</code>.</li>
<li>For values where the cause is null and the vehicle is not-null, set the cause to <code>Unspecified</code>.</li>
</ul>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_missing():</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    v_missing_data <span class="op">=</span> []</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>):</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        v_col <span class="op">=</span> <span class="st">'vehicle_</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(v)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        c_col <span class="op">=</span> <span class="st">'cause_vehicle_</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(v)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        v_missing <span class="op">=</span> (mvc[v_col].isnull() <span class="op">&amp;</span> mvc[c_col].notnull()).<span class="bu">sum</span>()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        c_missing <span class="op">=</span> (mvc[c_col].isnull() <span class="op">&amp;</span> mvc[v_col].notnull()).<span class="bu">sum</span>()</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        v_missing_data.append([v, v_missing, c_missing])</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    col_labels <span class="op">=</span> columns<span class="op">=</span>[<span class="st">"vehicle_number"</span>, <span class="st">"vehicle_missing"</span>, <span class="st">"cause_missing"</span>]</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(v_missing_data, columns<span class="op">=</span>col_labels)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>summarize_missing()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>vehicle_number</th>
      <th>vehicle_missing</th>
      <th>cause_missing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>204</td>
      <td>24</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>3793</td>
      <td>223</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>242</td>
      <td>24</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>50</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>10</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> v <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    v_col <span class="op">=</span> <span class="st">'vehicle_</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(v)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    c_col <span class="op">=</span> <span class="st">'cause_vehicle_</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(v)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    mvc[v_col] <span class="op">=</span> mvc[v_col].mask( mvc[v_col].isnull() <span class="op">&amp;</span> mvc[c_col].notnull(), <span class="st">'Unspecified'</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    mvc[c_col] <span class="op">=</span> mvc[c_col].mask(mvc[v_col].notnull() <span class="op">&amp;</span> mvc[c_col].isnull(), <span class="st">"Unspecified"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>summarize_missing()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>vehicle_number</th>
      <th>vehicle_missing</th>
      <th>cause_missing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="missing-data-in-the-location-column" class="level2">
<h2 class="anchored" data-anchor-id="missing-data-in-the-location-column">Missing data in the “location” column</h2>
<p>Let’s view the work we’ve done across the past few screens by looking at the null correlation plot for the last 10 columns:</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>veh_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> mvc.columns <span class="cf">if</span> <span class="st">'vehicle'</span> <span class="kw">in</span> c]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>plot_null_correlations(mvc[veh_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-08-25-Working with Missing Data_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>You can see the perfect correlation between each pair of vehicle/cause columns represented by 1.0 in each square, which means that there is a perfect relationship between the five pairs of vehicle/cause columns</p>
<p>Let’s now turn our focus to the final set of columns that contain missing values — the columns that relate to the location of the accident. We’ll start by looking at the first few rows to refamiliarize ourselves with the data:</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>loc_cols <span class="op">=</span> [<span class="st">'borough'</span>, <span class="st">'location'</span>, <span class="st">'on_street'</span>, <span class="st">'off_street'</span>, <span class="st">'cross_street'</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>location_data <span class="op">=</span> mvc[loc_cols]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>location_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>borough</th>
      <th>location</th>
      <th>on_street</th>
      <th>off_street</th>
      <th>cross_street</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MANHATTAN</td>
      <td>(40.742832, -74.00771)</td>
      <td>WEST 15 STREET</td>
      <td>NaN</td>
      <td>10 AVENUE</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BROOKLYN</td>
      <td>(40.623714, -73.99314)</td>
      <td>16 AVENUE</td>
      <td>NaN</td>
      <td>62 STREET</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>(40.591755, -73.9083)</td>
      <td>BELT PARKWAY</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>QUEENS</td>
      <td>(40.73602, -73.87954)</td>
      <td>GRAND AVENUE</td>
      <td>NaN</td>
      <td>VANLOON STREET</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BRONX</td>
      <td>(40.884727, -73.89945)</td>
      <td>NaN</td>
      <td>208       WEST 238 STREET</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Next, let’s look at counts of the null values in each column:</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>location_data.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>borough         20646
location         3885
on_street       13961
off_street      44093
cross_street    29249
dtype: int64</code></pre>
</div>
</div>
<p>These columns have a lot of missing values! Keep in mind that all of these five columns represent the same thing — the location of the collision. We can potentially use the non-null values to impute some of the null values.</p>
<p>To see where we might be able to do this, let’s look for correlations between the missing values:</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>plot_null_correlations(location_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-08-25-Working with Missing Data_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>None of these columns have strong correlations except for <code>off_street</code> and <code>on_street</code> which have a near perfect negative correlation. That means for almost every row that has a null value in one column, the other has a non-null value and vice-versa.</p>
<p>The final way we’ll look at the null values in these columns is to plot a null matrix, but we’ll sort the data first. This will gather some of the null and non-null values together and make patterns more obvious:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>sorted_location_data <span class="op">=</span> location_data.sort_values(loc_cols)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>plot_null_matrix(sorted_location_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-08-25-Working with Missing Data_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Let’s make some observations about the missing values across these columns:</p>
<ul>
<li>About two-thirds of rows have non-null values for <code>borough</code>, but of those values that are missing, most have non-null values for <code>location</code> and one or more of the <code>street</code> name columns.</li>
<li>Less than one-tenth of rows have missing values in the <code>location</code> column, but most of these have non-null values in one or more of the <code>street</code> name columns.</li>
<li>Most rows have a non-null value for either <code>on_street</code> or <code>off_street</code>, and some also have a value for <code>cross_street</code>.</li>
</ul>
<p>Combined, this means that we will be able to impute a lot of the missing values by using the other columns in each row. To do this, we can use geolocation APIs that take either an address or location coordinates, and return information about that location.</p>
</section>
<section id="imputing-location-data" class="level2">
<h2 class="anchored" data-anchor-id="imputing-location-data">Imputing Location Data</h2>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>sup_data <span class="op">=</span> pd.read_csv(<span class="st">'../datasets/supplemental_data.csv'</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>sup_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unique_key</th>
      <th>location</th>
      <th>on_street</th>
      <th>off_street</th>
      <th>borough</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3869058</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3847947</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3914294</td>
      <td>NaN</td>
      <td>BELT PARKWAY</td>
      <td>NaN</td>
      <td>BROOKLYN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3915069</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3923123</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>The supplemental data has five columns from our original data set — the <code>unique_key</code> that identifies each collision, and four of the five location columns. The cross_street column is not included because the geocoding APIs we used don’t include data on the nearest cross street to any single location.</p>
<p>Let’s take a look at a null matrix for the supplemental data:</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>plot_null_matrix(sup_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2020-08-25-Working with Missing Data_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Apart from the <code>unique_key</code> column, you’ll notice that there are a lot more missing values than our main data set. This makes sense, as we didn’t prepare supplemental data where the original data set had non-null values.</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>mvc.unique_key.equals(sup_data.unique_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>True</code></pre>
</div>
</div>
<p>both the original and supplemental data has the same values in the same order, we’ll be able to use <code>Series.mask()</code> to add our supplemental data to our original data.</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>location_cols <span class="op">=</span> [<span class="st">'location'</span>, <span class="st">'on_street'</span>, <span class="st">'off_street'</span>, <span class="st">'borough'</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>mvc[location_cols].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>location       3885
on_street     13961
off_street    44093
borough       20646
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> location_cols:</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    mvc[c] <span class="op">=</span> mvc[c].mask(mvc[c].isnull(), sup_data[c])</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>mvc[location_cols].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>location         77
on_street     13734
off_street    36131
borough         232
dtype: int64</code></pre>
</div>
</div>
<p>we’ve imputed thousands of values to reduce the number of missing values across our data set. Let’s look at a summary of the null values</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>mvc.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>unique_key                 0
date                       0
time                       0
borough                  232
location                  77
on_street              13734
cross_street           29249
off_street             36131
pedestrians_injured        0
cyclist_injured            0
motorist_injured           0
total_injured             21
pedestrians_killed         0
cyclist_killed             0
motorist_killed            0
total_killed               1
vehicle_1                151
vehicle_2               8469
vehicle_3              54110
vehicle_4              57108
vehicle_5              57671
cause_vehicle_1          151
cause_vehicle_2         8469
cause_vehicle_3        54110
cause_vehicle_4        57108
cause_vehicle_5        57671
dtype: int64</code></pre>
</div>
</div>
<p>If we’d like to continue working with this data, we can:</p>
<ul>
<li>Drop the rows that had suspect values for <code>injured</code> and <code>killed</code> totals.</li>
<li>Clean the values in the <code>vehicle_1</code> through <code>vehicle_5</code> columns by analyzing the different values and merging duplicates and near-duplicates.</li>
<li>Analyze whether collisions are more likely in certain locations, at certain times, or for certain vehicle types.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>